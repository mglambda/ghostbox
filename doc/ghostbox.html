<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.1"/>
    <title>ghostbox API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#from_generic">from_generic</a>
            </li>
            <li>
                    <a class="function" href="#from_openai_legacy">from_openai_legacy</a>
            </li>
            <li>
                    <a class="function" href="#from_llamacpp">from_llamacpp</a>
            </li>
            <li>
                    <a class="function" href="#from_openai_official">from_openai_official</a>
            </li>
            <li>
                    <a class="class" href="#Ghostbox">Ghostbox</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Ghostbox.__init__">Ghostbox</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.options">options</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.option">option</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.set">set</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.get">get</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.set_vars">set_vars</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.is_busy">is_busy</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.timings">timings</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.text">text</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.text_async">text_async</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.text_stream">text_stream</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.json">json</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.json_async">json_async</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.new">new</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.images">images</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.audio_start_transcription">audio_start_transcription</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.audio_stop_transcription">audio_stop_transcription</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.start_session">start_session</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.load_config">load_config</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.tools_inject_dependency">tools_inject_dependency</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.tts_say">tts_say</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.tts_stop">tts_stop</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.set_char">set_char</a>
                        </li>
                        <li>
                                <a class="function" href="#Ghostbox.history">history</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ChatMessage">ChatMessage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ChatMessage.role">role</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChatMessage.content">content</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChatMessage.tool_calls">tool_calls</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChatMessage.tool_name">tool_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChatMessage.tool_call_id">tool_call_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#ChatMessage.model_config">model_config</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#LLMBackend">LLMBackend</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#LLMBackend.generic">generic</a>
                        </li>
                        <li>
                                <a class="variable" href="#LLMBackend.legacy">legacy</a>
                        </li>
                        <li>
                                <a class="variable" href="#LLMBackend.llamacpp">llamacpp</a>
                        </li>
                        <li>
                                <a class="variable" href="#LLMBackend.koboldcpp">koboldcpp</a>
                        </li>
                        <li>
                                <a class="variable" href="#LLMBackend.openai">openai</a>
                        </li>
                        <li>
                                <a class="variable" href="#LLMBackend.dummy">dummy</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TTSModel">TTSModel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#TTSModel.zonos">zonos</a>
                        </li>
                        <li>
                                <a class="variable" href="#TTSModel.kokoro">kokoro</a>
                        </li>
                        <li>
                                <a class="variable" href="#TTSModel.xtts">xtts</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TTSOutputMethod">TTSOutputMethod</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#TTSOutputMethod.default">default</a>
                        </li>
                        <li>
                                <a class="variable" href="#TTSOutputMethod.websock">websock</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PromptFormatTemplateSpecialValue">PromptFormatTemplateSpecialValue</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#PromptFormatTemplateSpecialValue.auto">auto</a>
                        </li>
                        <li>
                                <a class="variable" href="#PromptFormatTemplateSpecialValue.guess">guess</a>
                        </li>
                        <li>
                                <a class="variable" href="#PromptFormatTemplateSpecialValue.raw">raw</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Timings">Timings</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Timings.prompt_n">prompt_n</a>
                        </li>
                        <li>
                                <a class="variable" href="#Timings.predicted_n">predicted_n</a>
                        </li>
                        <li>
                                <a class="variable" href="#Timings.cached_n">cached_n</a>
                        </li>
                        <li>
                                <a class="variable" href="#Timings.truncated">truncated</a>
                        </li>
                        <li>
                                <a class="variable" href="#Timings.prompt_ms">prompt_ms</a>
                        </li>
                        <li>
                                <a class="variable" href="#Timings.predicted_ms">predicted_ms</a>
                        </li>
                        <li>
                                <a class="variable" href="#Timings.predicted_per_second">predicted_per_second</a>
                        </li>
                        <li>
                                <a class="variable" href="#Timings.predicted_per_token_ms">predicted_per_token_ms</a>
                        </li>
                        <li>
                                <a class="variable" href="#Timings.original_timings">original_timings</a>
                        </li>
                        <li>
                                <a class="function" href="#Timings.total_n">total_n</a>
                        </li>
                        <li>
                                <a class="function" href="#Timings.total_ms">total_ms</a>
                        </li>
                        <li>
                                <a class="variable" href="#Timings.model_config">model_config</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#api_default_options">api_default_options</a>
            </li>
            <li>
                    <a class="function" href="#get_ghostbox_data">get_ghostbox_data</a>
            </li>
            <li>
                    <a class="function" href="#get_ghostbox_html_path">get_ghostbox_html_path</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
ghostbox    </h1>

                
                        <input id="mod-ghostbox-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-ghostbox-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="c1"># __all__ = [&quot;I will get rewritten&quot;]</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="c1">## Don&#39;t modify the line above, or this line!</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="c1"># import automodinit</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="c1"># automodinit.automodinit(__name__, __file__, globals())</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="c1"># del automodinit</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">ghostbox.api</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">ghostbox.definitions</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="n">_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_ghostbox_data</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns PATH preceded by the location of the ghostbox data dir, which is part of the python site-package.&quot;&quot;&quot;</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a>    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_ROOT</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_ghostbox_html_path</span><span class="p">():</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the path to the index.html and javascript files for the integrated HTTP server.&quot;&quot;&quot;</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_ROOT</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">)</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a>    <span class="s2">&quot;from_generic&quot;</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a>    <span class="s2">&quot;from_openai_legacy&quot;</span><span class="p">,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a>    <span class="s2">&quot;from_llamacpp&quot;</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a>    <span class="s2">&quot;from_openai_official&quot;</span><span class="p">,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a>    <span class="s2">&quot;Ghostbox&quot;</span><span class="p">,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a>    <span class="s2">&quot;ChatMessage&quot;</span><span class="p">,</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a>    <span class="s2">&quot;LLMBackend&quot;</span><span class="p">,</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">33</span></a>    <span class="s2">&quot;TTSModel&quot;</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">34</span></a>    <span class="s2">&quot;TTSOutputMethod&quot;</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">35</span></a>    <span class="s2">&quot;PromptFormatTemplateSpecialValue&quot;</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">36</span></a>    <span class="s2">&quot;Timings&quot;</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">37</span></a>    <span class="s2">&quot;api_default_options&quot;</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">38</span></a>    <span class="s2">&quot;get_ghostbox_data&quot;</span><span class="p">,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">39</span></a>    <span class="s2">&quot;get_ghostbox_html_path&quot;</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">40</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="from_generic">
                            <input id="from_generic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">from_generic</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">endpoint</span><span class="o">=</span><span class="s1">&#39;http://localhost:8080&#39;</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="from_generic-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#from_generic"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="from_generic-22"><a href="#from_generic-22"><span class="linenos">22</span></a><span class="k">def</span><span class="w"> </span><span class="nf">from_generic</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;http://localhost:8080&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="from_generic-23"><a href="#from_generic-23"><span class="linenos">23</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a Ghostbox instance that connects to an OpenAI API compatible endpoint.</span>
</span><span id="from_generic-24"><a href="#from_generic-24"><span class="linenos">24</span></a><span class="sd">    This generic backend adapter works with many backends, including llama.cpp, llama-box, ollama, as well as online providers, like OpenAI, Anthropic, etc. However, to use features specific to a given backend, that are not part of the OpenAI API, you may need to use a more specific backend.</span>
</span><span id="from_generic-25"><a href="#from_generic-25"><span class="linenos">25</span></a><span class="sd">    Note: Expects ENDPOINT to serve /v1/chat/completions and similar, so e.g. http://localhost:8080/v1/chat/completions should be reachable.</span>
</span><span id="from_generic-26"><a href="#from_generic-26"><span class="linenos">26</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="from_generic-27"><a href="#from_generic-27"><span class="linenos">27</span></a>    <span class="k">return</span> <span class="n">Ghostbox</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">LLMBackend</span><span class="o">.</span><span class="n">generic</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns a Ghostbox instance that connects to an OpenAI API compatible endpoint.
This generic backend adapter works with many backends, including llama.cpp, llama-box, ollama, as well as online providers, like OpenAI, Anthropic, etc. However, to use features specific to a given backend, that are not part of the OpenAI API, you may need to use a more specific backend.
Note: Expects ENDPOINT to serve /v1/chat/completions and similar, so e.g. <a href="http://localhost:8080/v1/chat/completions">http://localhost:8080/v1/chat/completions</a> should be reachable.</p>
</div>


                </section>
                <section id="from_openai_legacy">
                            <input id="from_openai_legacy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">from_openai_legacy</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">endpoint</span><span class="o">=</span><span class="s1">&#39;http://localhost:8080&#39;</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="from_openai_legacy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#from_openai_legacy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="from_openai_legacy-30"><a href="#from_openai_legacy-30"><span class="linenos">30</span></a><span class="k">def</span><span class="w"> </span><span class="nf">from_openai_legacy</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;http://localhost:8080&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="from_openai_legacy-31"><a href="#from_openai_legacy-31"><span class="linenos">31</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a Ghostbox instance that connects to an OpenAI API compatible endpoint using the legacy /v1/completions interface.</span>
</span><span id="from_openai_legacy-32"><a href="#from_openai_legacy-32"><span class="linenos">32</span></a><span class="sd">    This generic backend adapter works with many backends, including llama.cpp, llama-box, ollama, as well as online providers, like OpenAI, Anthropic, etc. However, to use features specific to a given backend, that are not part of the OpenAI API, you may need to use a more specific backend.</span>
</span><span id="from_openai_legacy-33"><a href="#from_openai_legacy-33"><span class="linenos">33</span></a><span class="sd">    Note: There is usually no reason to use this over the generic variant.&quot;&quot;&quot;</span>
</span><span id="from_openai_legacy-34"><a href="#from_openai_legacy-34"><span class="linenos">34</span></a>    <span class="k">return</span> <span class="n">Ghostbox</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">LLMBackend</span><span class="o">.</span><span class="n">legacy</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns a Ghostbox instance that connects to an OpenAI API compatible endpoint using the legacy /v1/completions interface.
This generic backend adapter works with many backends, including llama.cpp, llama-box, ollama, as well as online providers, like OpenAI, Anthropic, etc. However, to use features specific to a given backend, that are not part of the OpenAI API, you may need to use a more specific backend.
Note: There is usually no reason to use this over the generic variant.</p>
</div>


                </section>
                <section id="from_llamacpp">
                            <input id="from_llamacpp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">from_llamacpp</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">endpoint</span><span class="o">=</span><span class="s1">&#39;http://localhost:8080&#39;</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="from_llamacpp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#from_llamacpp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="from_llamacpp-37"><a href="#from_llamacpp-37"><span class="linenos">37</span></a><span class="k">def</span><span class="w"> </span><span class="nf">from_llamacpp</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;http://localhost:8080&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="from_llamacpp-38"><a href="#from_llamacpp-38"><span class="linenos">38</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a Ghostbox instance bound to the formidable LLama.cpp. See https://github.com/ggml-org/llama.cpp .</span>
</span><span id="from_llamacpp-39"><a href="#from_llamacpp-39"><span class="linenos">39</span></a><span class="sd">    This uses endpoints described in the llama-server documentation, and will make use of Llama.cpp specific features.</span>
</span><span id="from_llamacpp-40"><a href="#from_llamacpp-40"><span class="linenos">40</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="from_llamacpp-41"><a href="#from_llamacpp-41"><span class="linenos">41</span></a>    <span class="k">return</span> <span class="n">Ghostbox</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">LLMBackend</span><span class="o">.</span><span class="n">llamacpp</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns a Ghostbox instance bound to the formidable LLama.cpp. See <a href="https://github.com/ggml-org/llama.cpp">https://github.com/ggml-org/llama.cpp</a> .
This uses endpoints described in the llama-server documentation, and will make use of Llama.cpp specific features.</p>
</div>


                </section>
                <section id="from_openai_official">
                            <input id="from_openai_official-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">from_openai_official</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="from_openai_official-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#from_openai_official"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="from_openai_official-49"><a href="#from_openai_official-49"><span class="linenos">49</span></a><span class="k">def</span><span class="w"> </span><span class="nf">from_openai_official</span><span class="p">():</span>
</span><span id="from_openai_official-50"><a href="#from_openai_official-50"><span class="linenos">50</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a Ghostbox instance that connects to the illustrious OpenAI API at their official servers.</span>
</span><span id="from_openai_official-51"><a href="#from_openai_official-51"><span class="linenos">51</span></a><span class="sd">    The endpoint is hardcoded for this one. Use the &#39;generic&#39; backend to connect to arbitrary URLs using the OpenAI API.</span>
</span><span id="from_openai_official-52"><a href="#from_openai_official-52"><span class="linenos">52</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="from_openai_official-53"><a href="#from_openai_official-53"><span class="linenos">53</span></a>    <span class="k">return</span> <span class="n">Ghostbox</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">LLMBackend</span><span class="o">.</span><span class="n">openai</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns a Ghostbox instance that connects to the illustrious OpenAI API at their official servers.
The endpoint is hardcoded for this one. Use the 'generic' backend to connect to arbitrary URLs using the OpenAI API.</p>
</div>


                </section>
                <section id="Ghostbox">
                            <input id="Ghostbox-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Ghostbox</span>:

                <label class="view-source-button" for="Ghostbox-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox-56"><a href="#Ghostbox-56"><span class="linenos"> 56</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Ghostbox</span><span class="p">:</span>
</span><span id="Ghostbox-57"><a href="#Ghostbox-57"><span class="linenos"> 57</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">backend</span><span class="p">:</span> <span class="n">LLMBackend</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Ghostbox-58"><a href="#Ghostbox-58"><span class="linenos"> 58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ct</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Ghostbox-59"><a href="#Ghostbox-59"><span class="linenos"> 59</span></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;endpoint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">endpoint</span>
</span><span id="Ghostbox-60"><a href="#Ghostbox-60"><span class="linenos"> 60</span></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;backend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">name</span>
</span><span id="Ghostbox-61"><a href="#Ghostbox-61"><span class="linenos"> 61</span></a>
</span><span id="Ghostbox-62"><a href="#Ghostbox-62"><span class="linenos"> 62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">|=</span> <span class="n">kwargs</span>
</span><span id="Ghostbox-63"><a href="#Ghostbox-63"><span class="linenos"> 63</span></a>        <span class="n">default_options</span><span class="p">,</span> <span class="n">tags</span> <span class="o">=</span> <span class="n">makeDefaultOptions</span><span class="p">()</span>
</span><span id="Ghostbox-64"><a href="#Ghostbox-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;_plumbing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Plumbing</span><span class="p">(</span>
</span><span id="Ghostbox-65"><a href="#Ghostbox-65"><span class="linenos"> 65</span></a>            <span class="n">options</span><span class="o">=</span><span class="n">default_options</span><span class="o">.</span><span class="vm">__dict__</span>
</span><span id="Ghostbox-66"><a href="#Ghostbox-66"><span class="linenos"> 66</span></a>            <span class="o">|</span> <span class="p">{</span>
</span><span id="Ghostbox-67"><a href="#Ghostbox-67"><span class="linenos"> 67</span></a>                <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
</span><span id="Ghostbox-68"><a href="#Ghostbox-68"><span class="linenos"> 68</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Ghostbox-69"><a href="#Ghostbox-69"><span class="linenos"> 69</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="Ghostbox-70"><a href="#Ghostbox-70"><span class="linenos"> 70</span></a>            <span class="p">},</span>
</span><span id="Ghostbox-71"><a href="#Ghostbox-71"><span class="linenos"> 71</span></a>            <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span>
</span><span id="Ghostbox-72"><a href="#Ghostbox-72"><span class="linenos"> 72</span></a>        <span class="p">)</span>
</span><span id="Ghostbox-73"><a href="#Ghostbox-73"><span class="linenos"> 73</span></a>
</span><span id="Ghostbox-74"><a href="#Ghostbox-74"><span class="linenos"> 74</span></a>        <span class="c1"># override with some API defaults</span>
</span><span id="Ghostbox-75"><a href="#Ghostbox-75"><span class="linenos"> 75</span></a>        <span class="c1"># FIXME: only if not specified by user</span>
</span><span id="Ghostbox-76"><a href="#Ghostbox-76"><span class="linenos"> 76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;_plumbing&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">options</span> <span class="o">|=</span> <span class="n">definitions</span><span class="o">.</span><span class="n">api_default_options</span>
</span><span id="Ghostbox-77"><a href="#Ghostbox-77"><span class="linenos"> 77</span></a>
</span><span id="Ghostbox-78"><a href="#Ghostbox-78"><span class="linenos"> 78</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="p">:</span>
</span><span id="Ghostbox-79"><a href="#Ghostbox-79"><span class="linenos"> 79</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="p">)</span>
</span><span id="Ghostbox-80"><a href="#Ghostbox-80"><span class="linenos"> 80</span></a>        <span class="n">setup_plumbing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="p">)</span>
</span><span id="Ghostbox-81"><a href="#Ghostbox-81"><span class="linenos"> 81</span></a>
</span><span id="Ghostbox-82"><a href="#Ghostbox-82"><span class="linenos"> 82</span></a>        <span class="c1"># for arcane reasons we must startthe tts after everything else</span>
</span><span id="Ghostbox-83"><a href="#Ghostbox-83"><span class="linenos"> 83</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">tts_flag</span><span class="p">:</span>
</span><span id="Ghostbox-84"><a href="#Ghostbox-84"><span class="linenos"> 84</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">tts_flag</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Ghostbox-85"><a href="#Ghostbox-85"><span class="linenos"> 85</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;tts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Ghostbox-86"><a href="#Ghostbox-86"><span class="linenos"> 86</span></a>            <span class="n">printerr</span><span class="p">(</span><span class="n">toggle_tts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="p">))</span>
</span><span id="Ghostbox-87"><a href="#Ghostbox-87"><span class="linenos"> 87</span></a>
</span><span id="Ghostbox-88"><a href="#Ghostbox-88"><span class="linenos"> 88</span></a>    <span class="nd">@contextmanager</span>
</span><span id="Ghostbox-89"><a href="#Ghostbox-89"><span class="linenos"> 89</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Ghostbox-90"><a href="#Ghostbox-90"><span class="linenos"> 90</span></a>        <span class="c1"># copy old values</span>
</span><span id="Ghostbox-91"><a href="#Ghostbox-91"><span class="linenos"> 91</span></a>        <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">}</span>
</span><span id="Ghostbox-92"><a href="#Ghostbox-92"><span class="linenos"> 92</span></a>        <span class="c1"># this has to be done one by one as setoptions has sideffects</span>
</span><span id="Ghostbox-93"><a href="#Ghostbox-93"><span class="linenos"> 93</span></a>        <span class="k">for</span> <span class="n">new_k</span><span class="p">,</span> <span class="n">new_v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Ghostbox-94"><a href="#Ghostbox-94"><span class="linenos"> 94</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="n">new_k</span><span class="p">,</span> <span class="n">new_v</span><span class="p">)</span>
</span><span id="Ghostbox-95"><a href="#Ghostbox-95"><span class="linenos"> 95</span></a>        <span class="k">yield</span> <span class="bp">self</span>
</span><span id="Ghostbox-96"><a href="#Ghostbox-96"><span class="linenos"> 96</span></a>        <span class="c1"># now unwind, also one by one</span>
</span><span id="Ghostbox-97"><a href="#Ghostbox-97"><span class="linenos"> 97</span></a>        <span class="k">for</span> <span class="n">old_k</span><span class="p">,</span> <span class="n">old_v</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Ghostbox-98"><a href="#Ghostbox-98"><span class="linenos"> 98</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="n">old_k</span><span class="p">,</span> <span class="n">old_v</span><span class="p">)</span>
</span><span id="Ghostbox-99"><a href="#Ghostbox-99"><span class="linenos"> 99</span></a>
</span><span id="Ghostbox-100"><a href="#Ghostbox-100"><span class="linenos">100</span></a>    <span class="nd">@contextmanager</span>
</span><span id="Ghostbox-101"><a href="#Ghostbox-101"><span class="linenos">101</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="Ghostbox-102"><a href="#Ghostbox-102"><span class="linenos">102</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">({</span><span class="n">name</span><span class="p">:</span> <span class="n">value</span><span class="p">}):</span>
</span><span id="Ghostbox-103"><a href="#Ghostbox-103"><span class="linenos">103</span></a>            <span class="k">yield</span> <span class="bp">self</span>
</span><span id="Ghostbox-104"><a href="#Ghostbox-104"><span class="linenos">104</span></a>
</span><span id="Ghostbox-105"><a href="#Ghostbox-105"><span class="linenos">105</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="n">option_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Ghostbox-106"><a href="#Ghostbox-106"><span class="linenos">106</span></a>        <span class="k">if</span> <span class="n">option_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
</span><span id="Ghostbox-107"><a href="#Ghostbox-107"><span class="linenos">107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">option_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Ghostbox-108"><a href="#Ghostbox-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="n">option_name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="Ghostbox-109"><a href="#Ghostbox-109"><span class="linenos">109</span></a>
</span><span id="Ghostbox-110"><a href="#Ghostbox-110"><span class="linenos">110</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
</span><span id="Ghostbox-111"><a href="#Ghostbox-111"><span class="linenos">111</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">getOption</span><span class="p">(</span><span class="n">option_name</span><span class="p">)</span>
</span><span id="Ghostbox-112"><a href="#Ghostbox-112"><span class="linenos">112</span></a>
</span><span id="Ghostbox-113"><a href="#Ghostbox-113"><span class="linenos">113</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">injections</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="Ghostbox-114"><a href="#Ghostbox-114"><span class="linenos">114</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">injections</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Ghostbox-115"><a href="#Ghostbox-115"><span class="linenos">115</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">setVar</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="Ghostbox-116"><a href="#Ghostbox-116"><span class="linenos">116</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Ghostbox-117"><a href="#Ghostbox-117"><span class="linenos">117</span></a>
</span><span id="Ghostbox-118"><a href="#Ghostbox-118"><span class="linenos">118</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
</span><span id="Ghostbox-119"><a href="#Ghostbox-119"><span class="linenos">119</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;_plumbing&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">getOption</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="Ghostbox-120"><a href="#Ghostbox-120"><span class="linenos">120</span></a>
</span><span id="Ghostbox-121"><a href="#Ghostbox-121"><span class="linenos">121</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
</span><span id="Ghostbox-122"><a href="#Ghostbox-122"><span class="linenos">122</span></a>        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;_plumbing&quot;</span><span class="p">:</span>
</span><span id="Ghostbox-123"><a href="#Ghostbox-123"><span class="linenos">123</span></a>            <span class="k">return</span>
</span><span id="Ghostbox-124"><a href="#Ghostbox-124"><span class="linenos">124</span></a>
</span><span id="Ghostbox-125"><a href="#Ghostbox-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
</span><span id="Ghostbox-126"><a href="#Ghostbox-126"><span class="linenos">126</span></a>            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="Ghostbox-127"><a href="#Ghostbox-127"><span class="linenos">127</span></a>
</span><span id="Ghostbox-128"><a href="#Ghostbox-128"><span class="linenos">128</span></a>        <span class="k">if</span> <span class="s2">&quot;_plumbing&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
</span><span id="Ghostbox-129"><a href="#Ghostbox-129"><span class="linenos">129</span></a>            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;_plumbing&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="Ghostbox-130"><a href="#Ghostbox-130"><span class="linenos">130</span></a>
</span><span id="Ghostbox-131"><a href="#Ghostbox-131"><span class="linenos">131</span></a>    <span class="c1"># diagnostics</span>
</span><span id="Ghostbox-132"><a href="#Ghostbox-132"><span class="linenos">132</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_busy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Ghostbox-133"><a href="#Ghostbox-133"><span class="linenos">133</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns true if an interaction with a backend is currently in progress.</span>
</span><span id="Ghostbox-134"><a href="#Ghostbox-134"><span class="linenos">134</span></a><span class="sd">        While busy, all changes to the state of options (e.g. via set or the options context manager) will be buffered and applied when the ghostbox is no longer busy.</span>
</span><span id="Ghostbox-135"><a href="#Ghostbox-135"><span class="linenos">135</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox-136"><a href="#Ghostbox-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">_frozen</span>
</span><span id="Ghostbox-137"><a href="#Ghostbox-137"><span class="linenos">137</span></a>
</span><span id="Ghostbox-138"><a href="#Ghostbox-138"><span class="linenos">138</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">timings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Timings</span><span class="p">]:</span>
</span><span id="Ghostbox-139"><a href="#Ghostbox-139"><span class="linenos">139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provides timing and usage statistics for the last request to the backend.</span>
</span><span id="Ghostbox-140"><a href="#Ghostbox-140"><span class="linenos">140</span></a><span class="sd">        Returns none if no timings are available, which may happen if either no request has been sent yet, or the backend doesn&#39;t support timing.</span>
</span><span id="Ghostbox-141"><a href="#Ghostbox-141"><span class="linenos">141</span></a><span class="sd">        :return: Either None or an object with timing statistics.</span>
</span><span id="Ghostbox-142"><a href="#Ghostbox-142"><span class="linenos">142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox-143"><a href="#Ghostbox-143"><span class="linenos">143</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">getBackend</span><span class="p">()</span><span class="o">.</span><span class="n">timings</span><span class="p">()</span>
</span><span id="Ghostbox-144"><a href="#Ghostbox-144"><span class="linenos">144</span></a>
</span><span id="Ghostbox-145"><a href="#Ghostbox-145"><span class="linenos">145</span></a>    <span class="c1"># these are the payload functions</span>
</span><span id="Ghostbox-146"><a href="#Ghostbox-146"><span class="linenos">146</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">text</span><span class="p">(</span>
</span><span id="Ghostbox-147"><a href="#Ghostbox-147"><span class="linenos">147</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Ghostbox-148"><a href="#Ghostbox-148"><span class="linenos">148</span></a>        <span class="n">prompt_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Ghostbox-149"><a href="#Ghostbox-149"><span class="linenos">149</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Ghostbox-150"><a href="#Ghostbox-150"><span class="linenos">150</span></a>        <span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="Ghostbox-151"><a href="#Ghostbox-151"><span class="linenos">151</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Ghostbox-152"><a href="#Ghostbox-152"><span class="linenos">152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate text based on a prompt.</span>
</span><span id="Ghostbox-153"><a href="#Ghostbox-153"><span class="linenos">153</span></a><span class="sd">        This function blocks until either the generation finishes, or a provided timeout is reached.</span>
</span><span id="Ghostbox-154"><a href="#Ghostbox-154"><span class="linenos">154</span></a><span class="sd">        :param prompt_text: The prompt given to the LLM backend.</span>
</span><span id="Ghostbox-155"><a href="#Ghostbox-155"><span class="linenos">155</span></a><span class="sd">        :param timeout: Number of seconds to wait before the generation is canceled.</span>
</span><span id="Ghostbox-156"><a href="#Ghostbox-156"><span class="linenos">156</span></a><span class="sd">        :param options: Additional options to pass to ghostbox and possibly the backend, e.g. `{&quot;min_p&quot;: 0.01}`. This is an alternative to the `with options` context manager.</span>
</span><span id="Ghostbox-157"><a href="#Ghostbox-157"><span class="linenos">157</span></a><span class="sd">        :return: A string that was generated by the backend, based on the provided prompt.</span>
</span><span id="Ghostbox-158"><a href="#Ghostbox-158"><span class="linenos">158</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox-159"><a href="#Ghostbox-159"><span class="linenos">159</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="Ghostbox-160"><a href="#Ghostbox-160"><span class="linenos">160</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">interactBlocking</span><span class="p">(</span><span class="n">prompt_text</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="Ghostbox-161"><a href="#Ghostbox-161"><span class="linenos">161</span></a>
</span><span id="Ghostbox-162"><a href="#Ghostbox-162"><span class="linenos">162</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">text_async</span><span class="p">(</span>
</span><span id="Ghostbox-163"><a href="#Ghostbox-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Ghostbox-164"><a href="#Ghostbox-164"><span class="linenos">164</span></a>        <span class="n">prompt_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Ghostbox-165"><a href="#Ghostbox-165"><span class="linenos">165</span></a>        <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="Ghostbox-166"><a href="#Ghostbox-166"><span class="linenos">166</span></a>        <span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="Ghostbox-167"><a href="#Ghostbox-167"><span class="linenos">167</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Ghostbox-168"><a href="#Ghostbox-168"><span class="linenos">168</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate text based on a prompt asynchronously.</span>
</span><span id="Ghostbox-169"><a href="#Ghostbox-169"><span class="linenos">169</span></a><span class="sd">        This function does not block. It returns immediately and calls the provided callback when the generation finishes.</span>
</span><span id="Ghostbox-170"><a href="#Ghostbox-170"><span class="linenos">170</span></a><span class="sd">        :param prompt_text: The prompt given to the LLM backend.</span>
</span><span id="Ghostbox-171"><a href="#Ghostbox-171"><span class="linenos">171</span></a><span class="sd">        :param callback: A function that accepts a string. This will be called when the generation finishes, with the generated string as the only parameter.</span>
</span><span id="Ghostbox-172"><a href="#Ghostbox-172"><span class="linenos">172</span></a><span class="sd">        :param options: Additional options to pass to ghostbox and possibly the backend, e.g. `{&quot;min_p&quot;: 0.01}`. This is an alternative to the `with options` context manager.</span>
</span><span id="Ghostbox-173"><a href="#Ghostbox-173"><span class="linenos">173</span></a><span class="sd">        :return: The ghostbox instance.</span>
</span><span id="Ghostbox-174"><a href="#Ghostbox-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox-175"><a href="#Ghostbox-175"><span class="linenos">175</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="Ghostbox-176"><a href="#Ghostbox-176"><span class="linenos">176</span></a>            <span class="c1"># FIXME: this is tricky as we immediately return and set stream = True again ??? what to do</span>
</span><span id="Ghostbox-177"><a href="#Ghostbox-177"><span class="linenos">177</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">prompt_text</span><span class="p">,</span> <span class="n">user_generation_callback</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>
</span><span id="Ghostbox-178"><a href="#Ghostbox-178"><span class="linenos">178</span></a>        <span class="k">return</span>
</span><span id="Ghostbox-179"><a href="#Ghostbox-179"><span class="linenos">179</span></a>
</span><span id="Ghostbox-180"><a href="#Ghostbox-180"><span class="linenos">180</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">text_stream</span><span class="p">(</span>
</span><span id="Ghostbox-181"><a href="#Ghostbox-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Ghostbox-182"><a href="#Ghostbox-182"><span class="linenos">182</span></a>        <span class="n">prompt_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Ghostbox-183"><a href="#Ghostbox-183"><span class="linenos">183</span></a>        <span class="n">chunk_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="Ghostbox-184"><a href="#Ghostbox-184"><span class="linenos">184</span></a>        <span class="n">generation_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Ghostbox-185"><a href="#Ghostbox-185"><span class="linenos">185</span></a>        <span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="Ghostbox-186"><a href="#Ghostbox-186"><span class="linenos">186</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Ghostbox-187"><a href="#Ghostbox-187"><span class="linenos">187</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate text based on a prompt and stream the response.</span>
</span><span id="Ghostbox-188"><a href="#Ghostbox-188"><span class="linenos">188</span></a><span class="sd">        This function does not block. It returns immediately and invokes the provided callbacks when their respective events procure.</span>
</span><span id="Ghostbox-189"><a href="#Ghostbox-189"><span class="linenos">189</span></a><span class="sd">        :param prompt_text: The prompt given to the LLM backend.</span>
</span><span id="Ghostbox-190"><a href="#Ghostbox-190"><span class="linenos">190</span></a><span class="sd">        :param chunk_callback: This is called for each token that the backend generates, with the token as sole parameter.</span>
</span><span id="Ghostbox-191"><a href="#Ghostbox-191"><span class="linenos">191</span></a><span class="sd">        :param generation_callback: This is called exactly once, upon completion of the response, with the entire generation as sole parameter. If you are thinking of concatenating all the tokens in chunk_callback, use this instead.</span>
</span><span id="Ghostbox-192"><a href="#Ghostbox-192"><span class="linenos">192</span></a><span class="sd">        :param options: Additional options to pass to ghostbox and possibly the backend, e.g. `{&quot;min_p&quot;: 0.01}`. This is an alternative to the `with options` context manager.</span>
</span><span id="Ghostbox-193"><a href="#Ghostbox-193"><span class="linenos">193</span></a><span class="sd">        :return: The ghostbox instance.</span>
</span><span id="Ghostbox-194"><a href="#Ghostbox-194"><span class="linenos">194</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox-195"><a href="#Ghostbox-195"><span class="linenos">195</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="Ghostbox-196"><a href="#Ghostbox-196"><span class="linenos">196</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span>
</span><span id="Ghostbox-197"><a href="#Ghostbox-197"><span class="linenos">197</span></a>                <span class="n">prompt_text</span><span class="p">,</span>
</span><span id="Ghostbox-198"><a href="#Ghostbox-198"><span class="linenos">198</span></a>                <span class="n">user_generation_callback</span><span class="o">=</span><span class="n">generation_callback</span><span class="p">,</span>
</span><span id="Ghostbox-199"><a href="#Ghostbox-199"><span class="linenos">199</span></a>                <span class="n">stream_callback</span><span class="o">=</span><span class="n">chunk_callback</span><span class="p">,</span>
</span><span id="Ghostbox-200"><a href="#Ghostbox-200"><span class="linenos">200</span></a>            <span class="p">)</span>
</span><span id="Ghostbox-201"><a href="#Ghostbox-201"><span class="linenos">201</span></a>        <span class="k">return</span>
</span><span id="Ghostbox-202"><a href="#Ghostbox-202"><span class="linenos">202</span></a>
</span><span id="Ghostbox-203"><a href="#Ghostbox-203"><span class="linenos">203</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Ghostbox-204"><a href="#Ghostbox-204"><span class="linenos">204</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_make_json_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="Ghostbox-205"><a href="#Ghostbox-205"><span class="linenos">205</span></a>        <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Ghostbox-206"><a href="#Ghostbox-206"><span class="linenos">206</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;json_object&quot;</span><span class="p">}</span>
</span><span id="Ghostbox-207"><a href="#Ghostbox-207"><span class="linenos">207</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;json_object&quot;</span><span class="p">,</span> <span class="s2">&quot;schema&quot;</span><span class="p">:</span> <span class="n">schema</span><span class="p">}</span>
</span><span id="Ghostbox-208"><a href="#Ghostbox-208"><span class="linenos">208</span></a>
</span><span id="Ghostbox-209"><a href="#Ghostbox-209"><span class="linenos">209</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">json</span><span class="p">(</span>
</span><span id="Ghostbox-210"><a href="#Ghostbox-210"><span class="linenos">210</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Ghostbox-211"><a href="#Ghostbox-211"><span class="linenos">211</span></a>        <span class="n">prompt_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Ghostbox-212"><a href="#Ghostbox-212"><span class="linenos">212</span></a>        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Ghostbox-213"><a href="#Ghostbox-213"><span class="linenos">213</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Ghostbox-214"><a href="#Ghostbox-214"><span class="linenos">214</span></a>        <span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="Ghostbox-215"><a href="#Ghostbox-215"><span class="linenos">215</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Ghostbox-216"><a href="#Ghostbox-216"><span class="linenos">216</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a prompt, returns structured output as a string that is json deserializable.</span>
</span><span id="Ghostbox-217"><a href="#Ghostbox-217"><span class="linenos">217</span></a><span class="sd">        Output is structured but somewhat unpredictable, unless you provide a json schema. If you are thinking about using pydantic objects and using their model_json_schema method, consider using the ghostbox.new method directly.</span>
</span><span id="Ghostbox-218"><a href="#Ghostbox-218"><span class="linenos">218</span></a><span class="sd">        :param prompt_text: The prompt text as natural language.</span>
</span><span id="Ghostbox-219"><a href="#Ghostbox-219"><span class="linenos">219</span></a><span class="sd">        :param schema: A dict representing a json schema, which will further restrict the generation.</span>
</span><span id="Ghostbox-220"><a href="#Ghostbox-220"><span class="linenos">220</span></a><span class="sd">        :param timeout: Number of seconds to wait before generation is canceled.</span>
</span><span id="Ghostbox-221"><a href="#Ghostbox-221"><span class="linenos">221</span></a><span class="sd">        :param options: Additional options that will be passed to the backend, e.g. `{&quot;min_p&quot;: 0.01}`.</span>
</span><span id="Ghostbox-222"><a href="#Ghostbox-222"><span class="linenos">222</span></a><span class="sd">        :return: A string that contains json, hopefully adequately satisfying the prompt.</span>
</span><span id="Ghostbox-223"><a href="#Ghostbox-223"><span class="linenos">223</span></a><span class="sd">        Example use:</span>
</span><span id="Ghostbox-224"><a href="#Ghostbox-224"><span class="linenos">224</span></a><span class="sd">        noises = json.loads(box.json(&quot;Can you list some animal noises? Please give key/value pairs.&quot;))</span>
</span><span id="Ghostbox-225"><a href="#Ghostbox-225"><span class="linenos">225</span></a><span class="sd">        noises is now e.g. {&quot;dog&quot;: &quot;woof&quot;, &quot;cat&quot;:&quot;meow&quot;, ...}</span>
</span><span id="Ghostbox-226"><a href="#Ghostbox-226"><span class="linenos">226</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox-227"><a href="#Ghostbox-227"><span class="linenos">227</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">response_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_json_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="Ghostbox-228"><a href="#Ghostbox-228"><span class="linenos">228</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">prompt_text</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="Ghostbox-229"><a href="#Ghostbox-229"><span class="linenos">229</span></a>
</span><span id="Ghostbox-230"><a href="#Ghostbox-230"><span class="linenos">230</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">json_async</span><span class="p">(</span>
</span><span id="Ghostbox-231"><a href="#Ghostbox-231"><span class="linenos">231</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Ghostbox-232"><a href="#Ghostbox-232"><span class="linenos">232</span></a>        <span class="n">prompt_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Ghostbox-233"><a href="#Ghostbox-233"><span class="linenos">233</span></a>        <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">dict</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="Ghostbox-234"><a href="#Ghostbox-234"><span class="linenos">234</span></a>        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Ghostbox-235"><a href="#Ghostbox-235"><span class="linenos">235</span></a>        <span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="Ghostbox-236"><a href="#Ghostbox-236"><span class="linenos">236</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Ghostbox-237"><a href="#Ghostbox-237"><span class="linenos">237</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;This is an asyncrhonous version of the json method. See its documentation for more. This method returns nothing but expects an additional callback parameter, which will be called with the generated json string as argument once the backend is done generating.</span>
</span><span id="Ghostbox-238"><a href="#Ghostbox-238"><span class="linenos">238</span></a><span class="sd">        This function does not block, but returns immediately.&quot;&quot;&quot;</span>
</span><span id="Ghostbox-239"><a href="#Ghostbox-239"><span class="linenos">239</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">response_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_json_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="Ghostbox-240"><a href="#Ghostbox-240"><span class="linenos">240</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">text_async</span><span class="p">(</span><span class="n">prompt_text</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>
</span><span id="Ghostbox-241"><a href="#Ghostbox-241"><span class="linenos">241</span></a>        <span class="k">return</span>
</span><span id="Ghostbox-242"><a href="#Ghostbox-242"><span class="linenos">242</span></a>
</span><span id="Ghostbox-243"><a href="#Ghostbox-243"><span class="linenos">243</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">new</span><span class="p">(</span>
</span><span id="Ghostbox-244"><a href="#Ghostbox-244"><span class="linenos">244</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Ghostbox-245"><a href="#Ghostbox-245"><span class="linenos">245</span></a>        <span class="n">pydantic_class</span><span class="p">,</span>
</span><span id="Ghostbox-246"><a href="#Ghostbox-246"><span class="linenos">246</span></a>        <span class="n">text_prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Ghostbox-247"><a href="#Ghostbox-247"><span class="linenos">247</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Ghostbox-248"><a href="#Ghostbox-248"><span class="linenos">248</span></a>        <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Ghostbox-249"><a href="#Ghostbox-249"><span class="linenos">249</span></a>        <span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="Ghostbox-250"><a href="#Ghostbox-250"><span class="linenos">250</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="Ghostbox-251"><a href="#Ghostbox-251"><span class="linenos">251</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a subclass of pydantic.BaseModel, returns a python object of that type, with its fields filled in by the LLM backend with adherence to a given text prompt.</span>
</span><span id="Ghostbox-252"><a href="#Ghostbox-252"><span class="linenos">252</span></a><span class="sd">        This function will block until either generation finishes or a provided timeout is reached.</span>
</span><span id="Ghostbox-253"><a href="#Ghostbox-253"><span class="linenos">253</span></a><span class="sd">        This function may raise a pydantic error if the object cannot be validated. Although the LLM will be forced to adhere to the pydantic data model, this can still happen occasionally, for example, in the case of refusals. Either use the retries argument, or wrap a call to new in a try block accordingly.</span>
</span><span id="Ghostbox-254"><a href="#Ghostbox-254"><span class="linenos">254</span></a><span class="sd">        :param pydantic_class: The type of object that should be created.</span>
</span><span id="Ghostbox-255"><a href="#Ghostbox-255"><span class="linenos">255</span></a><span class="sd">        :param text_prompt: Prompt given to the LLM that should aid in object creation. This will influence how the pydantic object&#39;s fields will be filled in. Depending on the model used, certain prompts may lead to refusal, even with object creation, so be careful.</span>
</span><span id="Ghostbox-256"><a href="#Ghostbox-256"><span class="linenos">256</span></a><span class="sd">        :param timeout: A timeout in seconds after which generation is canceled.</span>
</span><span id="Ghostbox-257"><a href="#Ghostbox-257"><span class="linenos">257</span></a><span class="sd">        :param retries: In case of a validation error, how often should the generation be retried? Since sampling, especially with temperature &gt; 0.0, is not deterministic, retries can eventually yield valid results. A value of 0 means no retries will be performed and the function raises an error on invalid data or refusal. A value of -1 means retry forever or until the timeout is reached.</span>
</span><span id="Ghostbox-258"><a href="#Ghostbox-258"><span class="linenos">258</span></a><span class="sd">        :param options: Additional options to pass to ghostbox and possibly the backend, e.g. `{&quot;min_p&quot;: 0.01}`. This is an alternative to the `with options` context manager.</span>
</span><span id="Ghostbox-259"><a href="#Ghostbox-259"><span class="linenos">259</span></a><span class="sd">        :return: A valid python object of the provided pydantic type, with its fields filled in.</span>
</span><span id="Ghostbox-260"><a href="#Ghostbox-260"><span class="linenos">260</span></a>
</span><span id="Ghostbox-261"><a href="#Ghostbox-261"><span class="linenos">261</span></a><span class="sd">        Example:</span>
</span><span id="Ghostbox-262"><a href="#Ghostbox-262"><span class="linenos">262</span></a>
</span><span id="Ghostbox-263"><a href="#Ghostbox-263"><span class="linenos">263</span></a><span class="sd">        ## animal.py</span>
</span><span id="Ghostbox-264"><a href="#Ghostbox-264"><span class="linenos">264</span></a><span class="sd">        ```python</span>
</span><span id="Ghostbox-265"><a href="#Ghostbox-265"><span class="linenos">265</span></a><span class="sd">        from pydantic import BaseModel</span>
</span><span id="Ghostbox-266"><a href="#Ghostbox-266"><span class="linenos">266</span></a><span class="sd">        import ghostbox, json</span>
</span><span id="Ghostbox-267"><a href="#Ghostbox-267"><span class="linenos">267</span></a>
</span><span id="Ghostbox-268"><a href="#Ghostbox-268"><span class="linenos">268</span></a><span class="sd">        class Animal(BaseModel):</span>
</span><span id="Ghostbox-269"><a href="#Ghostbox-269"><span class="linenos">269</span></a><span class="sd">            name: str</span>
</span><span id="Ghostbox-270"><a href="#Ghostbox-270"><span class="linenos">270</span></a><span class="sd">            cute_name: str</span>
</span><span id="Ghostbox-271"><a href="#Ghostbox-271"><span class="linenos">271</span></a><span class="sd">            number_of_legs: int</span>
</span><span id="Ghostbox-272"><a href="#Ghostbox-272"><span class="linenos">272</span></a><span class="sd">            friendly: bool</span>
</span><span id="Ghostbox-273"><a href="#Ghostbox-273"><span class="linenos">273</span></a><span class="sd">            favorite_foods: List[str]</span>
</span><span id="Ghostbox-274"><a href="#Ghostbox-274"><span class="linenos">274</span></a>
</span><span id="Ghostbox-275"><a href="#Ghostbox-275"><span class="linenos">275</span></a><span class="sd">        box = ghostbox.from_generic(...)</span>
</span><span id="Ghostbox-276"><a href="#Ghostbox-276"><span class="linenos">276</span></a><span class="sd">        cat = box.new(Animal, &quot;Please generate a cute housecat.&quot;)</span>
</span><span id="Ghostbox-277"><a href="#Ghostbox-277"><span class="linenos">277</span></a><span class="sd">        print(json.dumps(cat.model_dump(), indent=4))</span>
</span><span id="Ghostbox-278"><a href="#Ghostbox-278"><span class="linenos">278</span></a><span class="sd">        ```</span>
</span><span id="Ghostbox-279"><a href="#Ghostbox-279"><span class="linenos">279</span></a>
</span><span id="Ghostbox-280"><a href="#Ghostbox-280"><span class="linenos">280</span></a><span class="sd">        ## Output</span>
</span><span id="Ghostbox-281"><a href="#Ghostbox-281"><span class="linenos">281</span></a>
</span><span id="Ghostbox-282"><a href="#Ghostbox-282"><span class="linenos">282</span></a><span class="sd">        ```bash</span>
</span><span id="Ghostbox-283"><a href="#Ghostbox-283"><span class="linenos">283</span></a><span class="sd">        $ python animal.py</span>
</span><span id="Ghostbox-284"><a href="#Ghostbox-284"><span class="linenos">284</span></a><span class="sd">        {</span>
</span><span id="Ghostbox-285"><a href="#Ghostbox-285"><span class="linenos">285</span></a><span class="sd">            &quot;name&quot; : &quot;Cat&quot;,</span>
</span><span id="Ghostbox-286"><a href="#Ghostbox-286"><span class="linenos">286</span></a><span class="sd">            &quot;cute_name&quot; : &quot;Dr. Kisses&quot;,</span>
</span><span id="Ghostbox-287"><a href="#Ghostbox-287"><span class="linenos">287</span></a><span class="sd">            &quot;number_of_legs&quot; : 4,</span>
</span><span id="Ghostbox-288"><a href="#Ghostbox-288"><span class="linenos">288</span></a><span class="sd">            &quot;friendly&quot; : true,</span>
</span><span id="Ghostbox-289"><a href="#Ghostbox-289"><span class="linenos">289</span></a><span class="sd">            &quot;favorite_foods&quot; : [&quot;Tuna&quot;, &quot;Cat Treats&quot;, &quot;Water from the toilet&quot;]</span>
</span><span id="Ghostbox-290"><a href="#Ghostbox-290"><span class="linenos">290</span></a><span class="sd">        }</span>
</span><span id="Ghostbox-291"><a href="#Ghostbox-291"><span class="linenos">291</span></a><span class="sd">        ```</span>
</span><span id="Ghostbox-292"><a href="#Ghostbox-292"><span class="linenos">292</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox-293"><a href="#Ghostbox-293"><span class="linenos">293</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="Ghostbox-294"><a href="#Ghostbox-294"><span class="linenos">294</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Ghostbox-295"><a href="#Ghostbox-295"><span class="linenos">295</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Ghostbox-296"><a href="#Ghostbox-296"><span class="linenos">296</span></a>                    <span class="k">return</span> <span class="n">pydantic_class</span><span class="p">(</span>
</span><span id="Ghostbox-297"><a href="#Ghostbox-297"><span class="linenos">297</span></a>                        <span class="o">**</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
</span><span id="Ghostbox-298"><a href="#Ghostbox-298"><span class="linenos">298</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">(</span>
</span><span id="Ghostbox-299"><a href="#Ghostbox-299"><span class="linenos">299</span></a>                                <span class="n">text_prompt</span><span class="p">,</span>
</span><span id="Ghostbox-300"><a href="#Ghostbox-300"><span class="linenos">300</span></a>                                <span class="n">schema</span><span class="o">=</span><span class="n">pydantic_class</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">(),</span>
</span><span id="Ghostbox-301"><a href="#Ghostbox-301"><span class="linenos">301</span></a>                                <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
</span><span id="Ghostbox-302"><a href="#Ghostbox-302"><span class="linenos">302</span></a>                            <span class="p">)</span>
</span><span id="Ghostbox-303"><a href="#Ghostbox-303"><span class="linenos">303</span></a>                        <span class="p">)</span>
</span><span id="Ghostbox-304"><a href="#Ghostbox-304"><span class="linenos">304</span></a>                    <span class="p">)</span>
</span><span id="Ghostbox-305"><a href="#Ghostbox-305"><span class="linenos">305</span></a>                <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Ghostbox-306"><a href="#Ghostbox-306"><span class="linenos">306</span></a>                    <span class="k">if</span> <span class="n">retries</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Ghostbox-307"><a href="#Ghostbox-307"><span class="linenos">307</span></a>                        <span class="k">raise</span> <span class="n">e</span>
</span><span id="Ghostbox-308"><a href="#Ghostbox-308"><span class="linenos">308</span></a>                    <span class="n">retries</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="Ghostbox-309"><a href="#Ghostbox-309"><span class="linenos">309</span></a>
</span><span id="Ghostbox-310"><a href="#Ghostbox-310"><span class="linenos">310</span></a>    <span class="c1"># images</span>
</span><span id="Ghostbox-311"><a href="#Ghostbox-311"><span class="linenos">311</span></a>    <span class="nd">@contextmanager</span>
</span><span id="Ghostbox-312"><a href="#Ghostbox-312"><span class="linenos">312</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_urls</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span><span id="Ghostbox-313"><a href="#Ghostbox-313"><span class="linenos">313</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a context in which ghostbox queries can refer to images.</span>
</span><span id="Ghostbox-314"><a href="#Ghostbox-314"><span class="linenos">314</span></a><span class="sd">        This context manager will not raise an error if an image cannot be found on the file system.</span>
</span><span id="Ghostbox-315"><a href="#Ghostbox-315"><span class="linenos">315</span></a><span class="sd">        :param image_urls: A list of either file system paths or web URLs (or both) that point to images.</span>
</span><span id="Ghostbox-316"><a href="#Ghostbox-316"><span class="linenos">316</span></a><span class="sd">        :return: A ghostbox instance.</span>
</span><span id="Ghostbox-317"><a href="#Ghostbox-317"><span class="linenos">317</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox-318"><a href="#Ghostbox-318"><span class="linenos">318</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_urls</span><span class="p">)):</span>
</span><span id="Ghostbox-319"><a href="#Ghostbox-319"><span class="linenos">319</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="n">image_urls</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Ghostbox-320"><a href="#Ghostbox-320"><span class="linenos">320</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">loadImage</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="Ghostbox-321"><a href="#Ghostbox-321"><span class="linenos">321</span></a>        <span class="k">yield</span> <span class="bp">self</span>
</span><span id="Ghostbox-322"><a href="#Ghostbox-322"><span class="linenos">322</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Ghostbox-323"><a href="#Ghostbox-323"><span class="linenos">323</span></a>
</span><span id="Ghostbox-324"><a href="#Ghostbox-324"><span class="linenos">324</span></a>    <span class="c1"># audio transcription</span>
</span><span id="Ghostbox-325"><a href="#Ghostbox-325"><span class="linenos">325</span></a>
</span><span id="Ghostbox-326"><a href="#Ghostbox-326"><span class="linenos">326</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">audio_start_transcription</span><span class="p">(</span>
</span><span id="Ghostbox-327"><a href="#Ghostbox-327"><span class="linenos">327</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Ghostbox-328"><a href="#Ghostbox-328"><span class="linenos">328</span></a>        <span class="n">transcription_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="Ghostbox-329"><a href="#Ghostbox-329"><span class="linenos">329</span></a>        <span class="n">threshold_activation_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="Ghostbox-330"><a href="#Ghostbox-330"><span class="linenos">330</span></a>    <span class="p">):</span>
</span><span id="Ghostbox-331"><a href="#Ghostbox-331"><span class="linenos">331</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start to continuously record and transcribe audio above a certain threshold.</span>
</span><span id="Ghostbox-332"><a href="#Ghostbox-332"><span class="linenos">332</span></a><span class="sd">        This method is for rolling your own transcriber. If you want to simply have the ghostbox react to a user saying things, just use the &quot;audio&quot;=True option. E.g.</span>
</span><span id="Ghostbox-333"><a href="#Ghostbox-333"><span class="linenos">333</span></a><span class="sd">        ```</span>
</span><span id="Ghostbox-334"><a href="#Ghostbox-334"><span class="linenos">334</span></a><span class="sd">        box = ghostbox.from_generic(character_folder=&quot;some_helpful_assistant&quot;,</span>
</span><span id="Ghostbox-335"><a href="#Ghostbox-335"><span class="linenos">335</span></a><span class="sd">            audio=True)</span>
</span><span id="Ghostbox-336"><a href="#Ghostbox-336"><span class="linenos">336</span></a><span class="sd">        while True:</span>
</span><span id="Ghostbox-337"><a href="#Ghostbox-337"><span class="linenos">337</span></a><span class="sd">            # the box will be transcribing and answering the transcribed text on a seperate thread</span>
</span><span id="Ghostbox-338"><a href="#Ghostbox-338"><span class="linenos">338</span></a><span class="sd">            # as if you had called box.text with the transcription</span>
</span><span id="Ghostbox-339"><a href="#Ghostbox-339"><span class="linenos">339</span></a><span class="sd">            # (provided silence threshold and activation phrase are met and given)</span>
</span><span id="Ghostbox-340"><a href="#Ghostbox-340"><span class="linenos">340</span></a><span class="sd">            # so we idle here</span>
</span><span id="Ghostbox-341"><a href="#Ghostbox-341"><span class="linenos">341</span></a><span class="sd">            time.sleep(0.3)</span>
</span><span id="Ghostbox-342"><a href="#Ghostbox-342"><span class="linenos">342</span></a><span class="sd">        ```</span>
</span><span id="Ghostbox-343"><a href="#Ghostbox-343"><span class="linenos">343</span></a>
</span><span id="Ghostbox-344"><a href="#Ghostbox-344"><span class="linenos">344</span></a><span class="sd">        You can configure this transcriber with the options context manager. See the various audio_* options for more. Especially the audio_silence_threshold may be interesting.</span>
</span><span id="Ghostbox-345"><a href="#Ghostbox-345"><span class="linenos">345</span></a><span class="sd">        If the transcription seems to do nothing, make sure the threshold is low enough and that no activation phrase is set.</span>
</span><span id="Ghostbox-346"><a href="#Ghostbox-346"><span class="linenos">346</span></a><span class="sd">        :param transcription_callback: A function that will be called whenever a successful transcription was made. For a transcription to be successful, three conditions must be met: 1. The microhphone must record sound above the activation threshold. 2. If an activation phrase is set, a fuzzy version of the phrase must be found in the transcription. 3. The recording must eventually register audio below the silence threshold again, ending the transcription. If all things are true, the callback will be invoked with the finished transcription. Note that this can be quiet a long time (tens of seconds) away from the beginning of recording.</span>
</span><span id="Ghostbox-347"><a href="#Ghostbox-347"><span class="linenos">347</span></a><span class="sd">        :param activation_callback: This function will be called whenever the audio recording goes above the silence threshold. It is called immediately when transcription begins. This is useful, if e.g. you are trying to build a responsive AI that stops the tts instantly when the user speaks.</span>
</span><span id="Ghostbox-348"><a href="#Ghostbox-348"><span class="linenos">348</span></a><span class="sd">        :return: The ghostbox instance.</span>
</span><span id="Ghostbox-349"><a href="#Ghostbox-349"><span class="linenos">349</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox-350"><a href="#Ghostbox-350"><span class="linenos">350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">audio_stop_transcription</span><span class="p">()</span>
</span><span id="Ghostbox-351"><a href="#Ghostbox-351"><span class="linenos">351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">whisper</span><span class="o">.</span><span class="n">transcribeContinuously</span><span class="p">(</span>
</span><span id="Ghostbox-352"><a href="#Ghostbox-352"><span class="linenos">352</span></a>            <span class="n">callback</span><span class="o">=</span><span class="n">transcription_callback</span><span class="p">,</span>
</span><span id="Ghostbox-353"><a href="#Ghostbox-353"><span class="linenos">353</span></a>            <span class="n">on_threshold</span><span class="o">=</span><span class="n">threshold_activation_callback</span><span class="p">,</span>
</span><span id="Ghostbox-354"><a href="#Ghostbox-354"><span class="linenos">354</span></a>            <span class="n">websock</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">getOption</span><span class="p">(</span><span class="s2">&quot;audio_websock&quot;</span><span class="p">),</span>
</span><span id="Ghostbox-355"><a href="#Ghostbox-355"><span class="linenos">355</span></a>            <span class="n">websock_host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">getOption</span><span class="p">(</span><span class="s2">&quot;audio_websock_host&quot;</span><span class="p">),</span>
</span><span id="Ghostbox-356"><a href="#Ghostbox-356"><span class="linenos">356</span></a>            <span class="n">websock_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">getOption</span><span class="p">(</span><span class="s2">&quot;audio_websock_port&quot;</span><span class="p">),</span>
</span><span id="Ghostbox-357"><a href="#Ghostbox-357"><span class="linenos">357</span></a>            <span class="n">silence_threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">getOption</span><span class="p">(</span><span class="s2">&quot;audio_silence_threshold&quot;</span><span class="p">),</span>
</span><span id="Ghostbox-358"><a href="#Ghostbox-358"><span class="linenos">358</span></a>        <span class="p">)</span>
</span><span id="Ghostbox-359"><a href="#Ghostbox-359"><span class="linenos">359</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Ghostbox-360"><a href="#Ghostbox-360"><span class="linenos">360</span></a>
</span><span id="Ghostbox-361"><a href="#Ghostbox-361"><span class="linenos">361</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">audio_stop_transcription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Ghostbox-362"><a href="#Ghostbox-362"><span class="linenos">362</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stops an ongoing continuous transcription.&quot;&quot;&quot;</span>
</span><span id="Ghostbox-363"><a href="#Ghostbox-363"><span class="linenos">363</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ct</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Ghostbox-364"><a href="#Ghostbox-364"><span class="linenos">364</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ct</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="Ghostbox-365"><a href="#Ghostbox-365"><span class="linenos">365</span></a>
</span><span id="Ghostbox-366"><a href="#Ghostbox-366"><span class="linenos">366</span></a>    <span class="c1"># managing ghostbox operation</span>
</span><span id="Ghostbox-367"><a href="#Ghostbox-367"><span class="linenos">367</span></a>
</span><span id="Ghostbox-368"><a href="#Ghostbox-368"><span class="linenos">368</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="Ghostbox-369"><a href="#Ghostbox-369"><span class="linenos">369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start a completely new session with a given character folder.</span>
</span><span id="Ghostbox-370"><a href="#Ghostbox-370"><span class="linenos">370</span></a><span class="sd">        This function wipes all history and context variables. It&#39;s a clean slate. If you want to switch characters while retaining context, use set_char instead.</span>
</span><span id="Ghostbox-371"><a href="#Ghostbox-371"><span class="linenos">371</span></a><span class="sd">        :param filepath: Path to a character folder.</span>
</span><span id="Ghostbox-372"><a href="#Ghostbox-372"><span class="linenos">372</span></a><span class="sd">        :return: The ghostbox instance.</span>
</span><span id="Ghostbox-373"><a href="#Ghostbox-373"><span class="linenos">373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox-374"><a href="#Ghostbox-374"><span class="linenos">374</span></a>        <span class="n">printerr</span><span class="p">(</span><span class="n">start_session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="p">,</span> <span class="n">filepath</span><span class="p">))</span>
</span><span id="Ghostbox-375"><a href="#Ghostbox-375"><span class="linenos">375</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Ghostbox-376"><a href="#Ghostbox-376"><span class="linenos">376</span></a>
</span><span id="Ghostbox-377"><a href="#Ghostbox-377"><span class="linenos">377</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="Ghostbox-378"><a href="#Ghostbox-378"><span class="linenos">378</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads a config file and applies the option/value pairs in it to this ghostbox instance.</span>
</span><span id="Ghostbox-379"><a href="#Ghostbox-379"><span class="linenos">379</span></a><span class="sd">        A config file contains a valid json string that describes an options dictionary.</span>
</span><span id="Ghostbox-380"><a href="#Ghostbox-380"><span class="linenos">380</span></a><span class="sd">        Configs loaded this way are intended to be user profiles or similar. AI character folders have their own config.json files that, by convention, are loaded automatically. If you want to simply configure an AI char, you should use their dedicated config file as it generally does *the right thing* when it comes to annoying stuff of overriding options and option precedence etc.</span>
</span><span id="Ghostbox-381"><a href="#Ghostbox-381"><span class="linenos">381</span></a><span class="sd">        Example:</span>
</span><span id="Ghostbox-382"><a href="#Ghostbox-382"><span class="linenos">382</span></a>
</span><span id="Ghostbox-383"><a href="#Ghostbox-383"><span class="linenos">383</span></a><span class="sd">        ## alice_config.json</span>
</span><span id="Ghostbox-384"><a href="#Ghostbox-384"><span class="linenos">384</span></a>
</span><span id="Ghostbox-385"><a href="#Ghostbox-385"><span class="linenos">385</span></a><span class="sd">        ```json</span>
</span><span id="Ghostbox-386"><a href="#Ghostbox-386"><span class="linenos">386</span></a><span class="sd">        {</span>
</span><span id="Ghostbox-387"><a href="#Ghostbox-387"><span class="linenos">387</span></a><span class="sd">            &quot;chat_user&quot; : &quot;alice&quot;,</span>
</span><span id="Ghostbox-388"><a href="#Ghostbox-388"><span class="linenos">388</span></a><span class="sd">            &quot;tts&quot;: true,</span>
</span><span id="Ghostbox-389"><a href="#Ghostbox-389"><span class="linenos">389</span></a><span class="sd">            &quot;tts_model&quot;: &quot;kokoro&quot;,</span>
</span><span id="Ghostbox-390"><a href="#Ghostbox-390"><span class="linenos">390</span></a><span class="sd">            &quot;tts_voice&quot;: &quot;af_sky&quot;,</span>
</span><span id="Ghostbox-391"><a href="#Ghostbox-391"><span class="linenos">391</span></a><span class="sd">            &quot;log_time&quot;: false</span>
</span><span id="Ghostbox-392"><a href="#Ghostbox-392"><span class="linenos">392</span></a><span class="sd">        }</span>
</span><span id="Ghostbox-393"><a href="#Ghostbox-393"><span class="linenos">393</span></a><span class="sd">        ```</span>
</span><span id="Ghostbox-394"><a href="#Ghostbox-394"><span class="linenos">394</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox-395"><a href="#Ghostbox-395"><span class="linenos">395</span></a>        <span class="n">printerr</span><span class="p">(</span><span class="n">load_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="p">,</span> <span class="n">config_file</span><span class="p">))</span>
</span><span id="Ghostbox-396"><a href="#Ghostbox-396"><span class="linenos">396</span></a>        <span class="c1"># FIXME: update self.__dict__?</span>
</span><span id="Ghostbox-397"><a href="#Ghostbox-397"><span class="linenos">397</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Ghostbox-398"><a href="#Ghostbox-398"><span class="linenos">398</span></a>
</span><span id="Ghostbox-399"><a href="#Ghostbox-399"><span class="linenos">399</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tools_inject_dependency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="Ghostbox-400"><a href="#Ghostbox-400"><span class="linenos">400</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a python object available in the python tool module of a running ghostbox AI, without having defined it in the tools.py.</span>
</span><span id="Ghostbox-401"><a href="#Ghostbox-401"><span class="linenos">401</span></a><span class="sd">        This can be used to inject dependencies from the &#39;outside&#39;. This is useful in cases where you must make an object available to the AI that can not be acquired during initialization of the tool module, for example, a resource manager, or a network connection.</span>
</span><span id="Ghostbox-402"><a href="#Ghostbox-402"><span class="linenos">402</span></a><span class="sd">        Note that the AI will not be aware of an injected dependency, and be unable to reference it. However, you can refer to the symbol_name in the functions you define for the AI, which will be a bound reference as soon as you inject the dependency. The AI may then use the functions that previously didn&#39;t refer to the object now bound by symbol_name.</span>
</span><span id="Ghostbox-403"><a href="#Ghostbox-403"><span class="linenos">403</span></a><span class="sd">        :param symbol_name: The name of the identifier to be injected. If this is e.g. &#39;point&#39;, point will be bound to obj in tools.py.</span>
</span><span id="Ghostbox-404"><a href="#Ghostbox-404"><span class="linenos">404</span></a><span class="sd">        :param obj: An arbitrary python object. A reference to object will be bound to symbol_name and be available in tools.py.</span>
</span><span id="Ghostbox-405"><a href="#Ghostbox-405"><span class="linenos">405</span></a><span class="sd">        :return: Ghostbox</span>
</span><span id="Ghostbox-406"><a href="#Ghostbox-406"><span class="linenos">406</span></a><span class="sd">        Here&#39;s an example use of dependency injection:</span>
</span><span id="Ghostbox-407"><a href="#Ghostbox-407"><span class="linenos">407</span></a><span class="sd">        ## human_resources.py</span>
</span><span id="Ghostbox-408"><a href="#Ghostbox-408"><span class="linenos">408</span></a><span class="sd">        ```python</span>
</span><span id="Ghostbox-409"><a href="#Ghostbox-409"><span class="linenos">409</span></a><span class="sd">        box = ghostbox.from_generic(...)</span>
</span><span id="Ghostbox-410"><a href="#Ghostbox-410"><span class="linenos">410</span></a><span class="sd">        # imaginary database connection e.g.</span>
</span><span id="Ghostbox-411"><a href="#Ghostbox-411"><span class="linenos">411</span></a><span class="sd">        # we don&#39;t want this in the tools.py of employee_assistant</span>
</span><span id="Ghostbox-412"><a href="#Ghostbox-412"><span class="linenos">412</span></a><span class="sd">        database_handle = EmployeeDatabase.open_connection(user=&quot;bob&quot;, password=&quot;bruce_schneier&quot;)</span>
</span><span id="Ghostbox-413"><a href="#Ghostbox-413"><span class="linenos">413</span></a><span class="sd">        # stuff happens, maybe we start a read/evaluate loop</span>
</span><span id="Ghostbox-414"><a href="#Ghostbox-414"><span class="linenos">414</span></a><span class="sd">        # ...</span>
</span><span id="Ghostbox-415"><a href="#Ghostbox-415"><span class="linenos">415</span></a>
</span><span id="Ghostbox-416"><a href="#Ghostbox-416"><span class="linenos">416</span></a><span class="sd">        # start our assistant</span>
</span><span id="Ghostbox-417"><a href="#Ghostbox-417"><span class="linenos">417</span></a><span class="sd">        box.start_session(&quot;employee_assistant&quot;)</span>
</span><span id="Ghostbox-418"><a href="#Ghostbox-418"><span class="linenos">418</span></a><span class="sd">        #without this, the tool calls would fail</span>
</span><span id="Ghostbox-419"><a href="#Ghostbox-419"><span class="linenos">419</span></a><span class="sd">        box.tools_inject_dependency(&quot;DBHANDLE&quot;, database_handle)</span>
</span><span id="Ghostbox-420"><a href="#Ghostbox-420"><span class="linenos">420</span></a><span class="sd">        with options{use_tools=True):</span>
</span><span id="Ghostbox-421"><a href="#Ghostbox-421"><span class="linenos">421</span></a><span class="sd">            good_employees = box.text(&quot;Can you give me a quick summary of all the employees in the database that have overperformed last motnh?&quot;)</span>
</span><span id="Ghostbox-422"><a href="#Ghostbox-422"><span class="linenos">422</span></a><span class="sd">        # do something with good_employees</span>
</span><span id="Ghostbox-423"><a href="#Ghostbox-423"><span class="linenos">423</span></a><span class="sd">        # ...</span>
</span><span id="Ghostbox-424"><a href="#Ghostbox-424"><span class="linenos">424</span></a><span class="sd">        ```</span>
</span><span id="Ghostbox-425"><a href="#Ghostbox-425"><span class="linenos">425</span></a>
</span><span id="Ghostbox-426"><a href="#Ghostbox-426"><span class="linenos">426</span></a><span class="sd">        ## employee_assistant/tools.py</span>
</span><span id="Ghostbox-427"><a href="#Ghostbox-427"><span class="linenos">427</span></a><span class="sd">        ```python</span>
</span><span id="Ghostbox-428"><a href="#Ghostbox-428"><span class="linenos">428</span></a><span class="sd">        # many tool definitions here</span>
</span><span id="Ghostbox-429"><a href="#Ghostbox-429"><span class="linenos">429</span></a><span class="sd">        # ...</span>
</span><span id="Ghostbox-430"><a href="#Ghostbox-430"><span class="linenos">430</span></a>
</span><span id="Ghostbox-431"><a href="#Ghostbox-431"><span class="linenos">431</span></a><span class="sd">        # then the one the AI will probably choose for our request above</span>
</span><span id="Ghostbox-432"><a href="#Ghostbox-432"><span class="linenos">432</span></a><span class="sd">        def query_database(sql_query: str) -&gt; Dict:</span>
</span><span id="Ghostbox-433"><a href="#Ghostbox-433"><span class="linenos">433</span></a><span class="sd">            # this would fail without dependency injection</span>
</span><span id="Ghostbox-434"><a href="#Ghostbox-434"><span class="linenos">434</span></a><span class="sd">            # since DBHANDLE is not defined in the module</span>
</span><span id="Ghostbox-435"><a href="#Ghostbox-435"><span class="linenos">435</span></a><span class="sd">            results = DBHANDLE.query(sql)</span>
</span><span id="Ghostbox-436"><a href="#Ghostbox-436"><span class="linenos">436</span></a><span class="sd">            # do stuff with results to bring it into a form the AI likes</span>
</span><span id="Ghostbox-437"><a href="#Ghostbox-437"><span class="linenos">437</span></a><span class="sd">            final = some_repackaging(results)</span>
</span><span id="Ghostbox-438"><a href="#Ghostbox-438"><span class="linenos">438</span></a><span class="sd">            return final</span>
</span><span id="Ghostbox-439"><a href="#Ghostbox-439"><span class="linenos">439</span></a><span class="sd">        ```</span>
</span><span id="Ghostbox-440"><a href="#Ghostbox-440"><span class="linenos">440</span></a>
</span><span id="Ghostbox-441"><a href="#Ghostbox-441"><span class="linenos">441</span></a><span class="sd">        At the point above where tools_inject_dependency is called, the DBHANDLE identified in the tools.py module becoems defined. Without the injection, referencing it would raise an exception.</span>
</span><span id="Ghostbox-442"><a href="#Ghostbox-442"><span class="linenos">442</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox-443"><a href="#Ghostbox-443"><span class="linenos">443</span></a>        <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">tools_module</span>
</span><span id="Ghostbox-444"><a href="#Ghostbox-444"><span class="linenos">444</span></a>        <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Ghostbox-445"><a href="#Ghostbox-445"><span class="linenos">445</span></a>            <span class="n">printerr</span><span class="p">(</span>
</span><span id="Ghostbox-446"><a href="#Ghostbox-446"><span class="linenos">446</span></a>                <span class="s2">&quot;warning: Unable to inject dependency &#39;&quot;</span>
</span><span id="Ghostbox-447"><a href="#Ghostbox-447"><span class="linenos">447</span></a>                <span class="o">+</span> <span class="n">symbol_name</span>
</span><span id="Ghostbox-448"><a href="#Ghostbox-448"><span class="linenos">448</span></a>                <span class="o">+</span> <span class="s2">&quot;&#39;. Tool module not initialized.&quot;</span>
</span><span id="Ghostbox-449"><a href="#Ghostbox-449"><span class="linenos">449</span></a>            <span class="p">)</span>
</span><span id="Ghostbox-450"><a href="#Ghostbox-450"><span class="linenos">450</span></a>            <span class="k">return</span> <span class="n">Self</span>
</span><span id="Ghostbox-451"><a href="#Ghostbox-451"><span class="linenos">451</span></a>
</span><span id="Ghostbox-452"><a href="#Ghostbox-452"><span class="linenos">452</span></a>        <span class="c1"># FIXME: should we warn users if they overriade an existing identifier? Let&#39;s do ti since if they injected once why do they need to do it again?</span>
</span><span id="Ghostbox-453"><a href="#Ghostbox-453"><span class="linenos">453</span></a>        <span class="k">if</span> <span class="n">symbol_name</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
</span><span id="Ghostbox-454"><a href="#Ghostbox-454"><span class="linenos">454</span></a>            <span class="n">printerr</span><span class="p">(</span>
</span><span id="Ghostbox-455"><a href="#Ghostbox-455"><span class="linenos">455</span></a>                <span class="s2">&quot;warning: While trying to inject a dependency: &#39;&quot;</span>
</span><span id="Ghostbox-456"><a href="#Ghostbox-456"><span class="linenos">456</span></a>                <span class="o">+</span> <span class="n">symbol_name</span>
</span><span id="Ghostbox-457"><a href="#Ghostbox-457"><span class="linenos">457</span></a>                <span class="o">+</span> <span class="s2">&quot;&#39; already exists in tool module.&quot;</span>
</span><span id="Ghostbox-458"><a href="#Ghostbox-458"><span class="linenos">458</span></a>            <span class="p">)</span>
</span><span id="Ghostbox-459"><a href="#Ghostbox-459"><span class="linenos">459</span></a>
</span><span id="Ghostbox-460"><a href="#Ghostbox-460"><span class="linenos">460</span></a>        <span class="n">module</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">symbol_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
</span><span id="Ghostbox-461"><a href="#Ghostbox-461"><span class="linenos">461</span></a>
</span><span id="Ghostbox-462"><a href="#Ghostbox-462"><span class="linenos">462</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tts_say</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">interrupt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="Ghostbox-463"><a href="#Ghostbox-463"><span class="linenos">463</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Speak something with the underlying TTS engine.</span>
</span><span id="Ghostbox-464"><a href="#Ghostbox-464"><span class="linenos">464</span></a><span class="sd">        You can modify the tts behaviour by wrapping this call in a `with options(...)` context. For possible options, see the ghostbox documentation of the various tts_* options.</span>
</span><span id="Ghostbox-465"><a href="#Ghostbox-465"><span class="linenos">465</span></a><span class="sd">        :param text: The text to be spoken.</span>
</span><span id="Ghostbox-466"><a href="#Ghostbox-466"><span class="linenos">466</span></a><span class="sd">        :param interrupt: If true, this call will interrupt speech output that is currently in progress (the default). Otherwise, text will be queue and spoken in sequence.</span>
</span><span id="Ghostbox-467"><a href="#Ghostbox-467"><span class="linenos">467</span></a><span class="sd">        :return: The ghostbox instance.</span>
</span><span id="Ghostbox-468"><a href="#Ghostbox-468"><span class="linenos">468</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox-469"><a href="#Ghostbox-469"><span class="linenos">469</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">communicateTTS</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">interrupt</span><span class="o">=</span><span class="n">interrupt</span><span class="p">)</span>
</span><span id="Ghostbox-470"><a href="#Ghostbox-470"><span class="linenos">470</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Ghostbox-471"><a href="#Ghostbox-471"><span class="linenos">471</span></a>
</span><span id="Ghostbox-472"><a href="#Ghostbox-472"><span class="linenos">472</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tts_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="Ghostbox-473"><a href="#Ghostbox-473"><span class="linenos">473</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stops speech output that is in progress.</span>
</span><span id="Ghostbox-474"><a href="#Ghostbox-474"><span class="linenos">474</span></a><span class="sd">        :return: The ghostbox instance.</span>
</span><span id="Ghostbox-475"><a href="#Ghostbox-475"><span class="linenos">475</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox-476"><a href="#Ghostbox-476"><span class="linenos">476</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">stopTTS</span><span class="p">()</span>
</span><span id="Ghostbox-477"><a href="#Ghostbox-477"><span class="linenos">477</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Ghostbox-478"><a href="#Ghostbox-478"><span class="linenos">478</span></a>
</span><span id="Ghostbox-479"><a href="#Ghostbox-479"><span class="linenos">479</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_char</span><span class="p">(</span>
</span><span id="Ghostbox-480"><a href="#Ghostbox-480"><span class="linenos">480</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Ghostbox-481"><a href="#Ghostbox-481"><span class="linenos">481</span></a>        <span class="n">character_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Ghostbox-482"><a href="#Ghostbox-482"><span class="linenos">482</span></a>        <span class="n">chat_history</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ChatMessage</span> <span class="o">|</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Ghostbox-483"><a href="#Ghostbox-483"><span class="linenos">483</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="Ghostbox-484"><a href="#Ghostbox-484"><span class="linenos">484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set an active character_folder, which may be the same one, and optionally set the chat history.</span>
</span><span id="Ghostbox-485"><a href="#Ghostbox-485"><span class="linenos">485</span></a><span class="sd">        This method differs from start_session in that it doesn&#39;t wipe various vars that may be set in the session, and preserves the chat history by default.</span>
</span><span id="Ghostbox-486"><a href="#Ghostbox-486"><span class="linenos">486</span></a><span class="sd">        Note: This will wipe the previous history unless chat_history is None.</span>
</span><span id="Ghostbox-487"><a href="#Ghostbox-487"><span class="linenos">487</span></a><span class="sd">        :param character_folder: The new character folder to load.</span>
</span><span id="Ghostbox-488"><a href="#Ghostbox-488"><span class="linenos">488</span></a><span class="sd">        :param chat_history: A list of ChatHistory items, valid JSON dictionaries that parse as ChatHistoryItems, or a mix of both. If None, chat history will be retained.</span>
</span><span id="Ghostbox-489"><a href="#Ghostbox-489"><span class="linenos">489</span></a><span class="sd">        :return: Ghostbox instance.&quot;&quot;&quot;</span>
</span><span id="Ghostbox-490"><a href="#Ghostbox-490"><span class="linenos">490</span></a>        <span class="k">if</span> <span class="n">character_folder</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">getOption</span><span class="p">(</span><span class="s2">&quot;character_folder&quot;</span><span class="p">):</span>
</span><span id="Ghostbox-491"><a href="#Ghostbox-491"><span class="linenos">491</span></a>            <span class="n">printerr</span><span class="p">(</span><span class="n">start_session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="p">,</span> <span class="n">character_folder</span><span class="p">))</span>
</span><span id="Ghostbox-492"><a href="#Ghostbox-492"><span class="linenos">492</span></a>
</span><span id="Ghostbox-493"><a href="#Ghostbox-493"><span class="linenos">493</span></a>        <span class="k">if</span> <span class="n">chat_history</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Ghostbox-494"><a href="#Ghostbox-494"><span class="linenos">494</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="Ghostbox-495"><a href="#Ghostbox-495"><span class="linenos">495</span></a>
</span><span id="Ghostbox-496"><a href="#Ghostbox-496"><span class="linenos">496</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">stories</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="Ghostbox-497"><a href="#Ghostbox-497"><span class="linenos">497</span></a>        <span class="n">story</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">stories</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="Ghostbox-498"><a href="#Ghostbox-498"><span class="linenos">498</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">chat_history</span><span class="p">:</span>
</span><span id="Ghostbox-499"><a href="#Ghostbox-499"><span class="linenos">499</span></a>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="n">ChatMessage</span><span class="p">:</span>
</span><span id="Ghostbox-500"><a href="#Ghostbox-500"><span class="linenos">500</span></a>                <span class="n">story</span><span class="o">.</span><span class="n">appendMessage</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="Ghostbox-501"><a href="#Ghostbox-501"><span class="linenos">501</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Ghostbox-502"><a href="#Ghostbox-502"><span class="linenos">502</span></a>                <span class="c1"># try to parse the item as ChatMessage</span>
</span><span id="Ghostbox-503"><a href="#Ghostbox-503"><span class="linenos">503</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Ghostbox-504"><a href="#Ghostbox-504"><span class="linenos">504</span></a>                    <span class="n">story</span><span class="o">.</span><span class="n">addRawJSON</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="Ghostbox-505"><a href="#Ghostbox-505"><span class="linenos">505</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="Ghostbox-506"><a href="#Ghostbox-506"><span class="linenos">506</span></a>                    <span class="n">printerr</span><span class="p">(</span>
</span><span id="Ghostbox-507"><a href="#Ghostbox-507"><span class="linenos">507</span></a>                        <span class="s2">&quot;warning: Couldn&#39;t parse chat history. Not a valid ChatMessage. Skipping message. Traceback below.&quot;</span>
</span><span id="Ghostbox-508"><a href="#Ghostbox-508"><span class="linenos">508</span></a>                    <span class="p">)</span>
</span><span id="Ghostbox-509"><a href="#Ghostbox-509"><span class="linenos">509</span></a>                    <span class="n">printerr</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
</span><span id="Ghostbox-510"><a href="#Ghostbox-510"><span class="linenos">510</span></a>                    <span class="k">continue</span>
</span><span id="Ghostbox-511"><a href="#Ghostbox-511"><span class="linenos">511</span></a>
</span><span id="Ghostbox-512"><a href="#Ghostbox-512"><span class="linenos">512</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Ghostbox-513"><a href="#Ghostbox-513"><span class="linenos">513</span></a>
</span><span id="Ghostbox-514"><a href="#Ghostbox-514"><span class="linenos">514</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Ghostbox-515"><a href="#Ghostbox-515"><span class="linenos">515</span></a>
</span><span id="Ghostbox-516"><a href="#Ghostbox-516"><span class="linenos">516</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">history</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ChatMessage</span><span class="p">]:</span>
</span><span id="Ghostbox-517"><a href="#Ghostbox-517"><span class="linenos">517</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the current chat history for this ghostbox instance.</span>
</span><span id="Ghostbox-518"><a href="#Ghostbox-518"><span class="linenos">518</span></a><span class="sd">        :return: The chat history.</span>
</span><span id="Ghostbox-519"><a href="#Ghostbox-519"><span class="linenos">519</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox-520"><a href="#Ghostbox-520"><span class="linenos">520</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">stories</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>
</span></pre></div>


    

                            <div id="Ghostbox.__init__" class="classattr">
                                        <input id="Ghostbox.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Ghostbox</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">backend</span><span class="p">:</span> <span class="n"><a href="#LLMBackend">LLMBackend</a></span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="Ghostbox.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.__init__-57"><a href="#Ghostbox.__init__-57"><span class="linenos">57</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">backend</span><span class="p">:</span> <span class="n">LLMBackend</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Ghostbox.__init__-58"><a href="#Ghostbox.__init__-58"><span class="linenos">58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ct</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Ghostbox.__init__-59"><a href="#Ghostbox.__init__-59"><span class="linenos">59</span></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;endpoint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">endpoint</span>
</span><span id="Ghostbox.__init__-60"><a href="#Ghostbox.__init__-60"><span class="linenos">60</span></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;backend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">name</span>
</span><span id="Ghostbox.__init__-61"><a href="#Ghostbox.__init__-61"><span class="linenos">61</span></a>
</span><span id="Ghostbox.__init__-62"><a href="#Ghostbox.__init__-62"><span class="linenos">62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">|=</span> <span class="n">kwargs</span>
</span><span id="Ghostbox.__init__-63"><a href="#Ghostbox.__init__-63"><span class="linenos">63</span></a>        <span class="n">default_options</span><span class="p">,</span> <span class="n">tags</span> <span class="o">=</span> <span class="n">makeDefaultOptions</span><span class="p">()</span>
</span><span id="Ghostbox.__init__-64"><a href="#Ghostbox.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;_plumbing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Plumbing</span><span class="p">(</span>
</span><span id="Ghostbox.__init__-65"><a href="#Ghostbox.__init__-65"><span class="linenos">65</span></a>            <span class="n">options</span><span class="o">=</span><span class="n">default_options</span><span class="o">.</span><span class="vm">__dict__</span>
</span><span id="Ghostbox.__init__-66"><a href="#Ghostbox.__init__-66"><span class="linenos">66</span></a>            <span class="o">|</span> <span class="p">{</span>
</span><span id="Ghostbox.__init__-67"><a href="#Ghostbox.__init__-67"><span class="linenos">67</span></a>                <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
</span><span id="Ghostbox.__init__-68"><a href="#Ghostbox.__init__-68"><span class="linenos">68</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Ghostbox.__init__-69"><a href="#Ghostbox.__init__-69"><span class="linenos">69</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="Ghostbox.__init__-70"><a href="#Ghostbox.__init__-70"><span class="linenos">70</span></a>            <span class="p">},</span>
</span><span id="Ghostbox.__init__-71"><a href="#Ghostbox.__init__-71"><span class="linenos">71</span></a>            <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span>
</span><span id="Ghostbox.__init__-72"><a href="#Ghostbox.__init__-72"><span class="linenos">72</span></a>        <span class="p">)</span>
</span><span id="Ghostbox.__init__-73"><a href="#Ghostbox.__init__-73"><span class="linenos">73</span></a>
</span><span id="Ghostbox.__init__-74"><a href="#Ghostbox.__init__-74"><span class="linenos">74</span></a>        <span class="c1"># override with some API defaults</span>
</span><span id="Ghostbox.__init__-75"><a href="#Ghostbox.__init__-75"><span class="linenos">75</span></a>        <span class="c1"># FIXME: only if not specified by user</span>
</span><span id="Ghostbox.__init__-76"><a href="#Ghostbox.__init__-76"><span class="linenos">76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;_plumbing&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">options</span> <span class="o">|=</span> <span class="n">definitions</span><span class="o">.</span><span class="n">api_default_options</span>
</span><span id="Ghostbox.__init__-77"><a href="#Ghostbox.__init__-77"><span class="linenos">77</span></a>
</span><span id="Ghostbox.__init__-78"><a href="#Ghostbox.__init__-78"><span class="linenos">78</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="p">:</span>
</span><span id="Ghostbox.__init__-79"><a href="#Ghostbox.__init__-79"><span class="linenos">79</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="p">)</span>
</span><span id="Ghostbox.__init__-80"><a href="#Ghostbox.__init__-80"><span class="linenos">80</span></a>        <span class="n">setup_plumbing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="p">)</span>
</span><span id="Ghostbox.__init__-81"><a href="#Ghostbox.__init__-81"><span class="linenos">81</span></a>
</span><span id="Ghostbox.__init__-82"><a href="#Ghostbox.__init__-82"><span class="linenos">82</span></a>        <span class="c1"># for arcane reasons we must startthe tts after everything else</span>
</span><span id="Ghostbox.__init__-83"><a href="#Ghostbox.__init__-83"><span class="linenos">83</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">tts_flag</span><span class="p">:</span>
</span><span id="Ghostbox.__init__-84"><a href="#Ghostbox.__init__-84"><span class="linenos">84</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">tts_flag</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Ghostbox.__init__-85"><a href="#Ghostbox.__init__-85"><span class="linenos">85</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;tts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Ghostbox.__init__-86"><a href="#Ghostbox.__init__-86"><span class="linenos">86</span></a>            <span class="n">printerr</span><span class="p">(</span><span class="n">toggle_tts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="p">))</span>
</span></pre></div>


    

                            </div>
                            <div id="Ghostbox.options" class="classattr">
                                        <input id="Ghostbox.options-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-contextmanager">@contextmanager</div>

        <span class="def">def</span>
        <span class="name">options</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Ghostbox.options-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.options"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.options-88"><a href="#Ghostbox.options-88"><span class="linenos">88</span></a>    <span class="nd">@contextmanager</span>
</span><span id="Ghostbox.options-89"><a href="#Ghostbox.options-89"><span class="linenos">89</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Ghostbox.options-90"><a href="#Ghostbox.options-90"><span class="linenos">90</span></a>        <span class="c1"># copy old values</span>
</span><span id="Ghostbox.options-91"><a href="#Ghostbox.options-91"><span class="linenos">91</span></a>        <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">}</span>
</span><span id="Ghostbox.options-92"><a href="#Ghostbox.options-92"><span class="linenos">92</span></a>        <span class="c1"># this has to be done one by one as setoptions has sideffects</span>
</span><span id="Ghostbox.options-93"><a href="#Ghostbox.options-93"><span class="linenos">93</span></a>        <span class="k">for</span> <span class="n">new_k</span><span class="p">,</span> <span class="n">new_v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Ghostbox.options-94"><a href="#Ghostbox.options-94"><span class="linenos">94</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="n">new_k</span><span class="p">,</span> <span class="n">new_v</span><span class="p">)</span>
</span><span id="Ghostbox.options-95"><a href="#Ghostbox.options-95"><span class="linenos">95</span></a>        <span class="k">yield</span> <span class="bp">self</span>
</span><span id="Ghostbox.options-96"><a href="#Ghostbox.options-96"><span class="linenos">96</span></a>        <span class="c1"># now unwind, also one by one</span>
</span><span id="Ghostbox.options-97"><a href="#Ghostbox.options-97"><span class="linenos">97</span></a>        <span class="k">for</span> <span class="n">old_k</span><span class="p">,</span> <span class="n">old_v</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Ghostbox.options-98"><a href="#Ghostbox.options-98"><span class="linenos">98</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="n">old_k</span><span class="p">,</span> <span class="n">old_v</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Ghostbox.option" class="classattr">
                                        <input id="Ghostbox.option-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-contextmanager">@contextmanager</div>

        <span class="def">def</span>
        <span class="name">option</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">name</span>, </span><span class="param"><span class="n">value</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Ghostbox.option-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.option"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.option-100"><a href="#Ghostbox.option-100"><span class="linenos">100</span></a>    <span class="nd">@contextmanager</span>
</span><span id="Ghostbox.option-101"><a href="#Ghostbox.option-101"><span class="linenos">101</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="Ghostbox.option-102"><a href="#Ghostbox.option-102"><span class="linenos">102</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">({</span><span class="n">name</span><span class="p">:</span> <span class="n">value</span><span class="p">}):</span>
</span><span id="Ghostbox.option-103"><a href="#Ghostbox.option-103"><span class="linenos">103</span></a>            <span class="k">yield</span> <span class="bp">self</span>
</span></pre></div>


    

                            </div>
                            <div id="Ghostbox.set" class="classattr">
                                        <input id="Ghostbox.set-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">option_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">value</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Ghostbox.set-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.set"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.set-105"><a href="#Ghostbox.set-105"><span class="linenos">105</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="n">option_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Ghostbox.set-106"><a href="#Ghostbox.set-106"><span class="linenos">106</span></a>        <span class="k">if</span> <span class="n">option_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
</span><span id="Ghostbox.set-107"><a href="#Ghostbox.set-107"><span class="linenos">107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">option_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Ghostbox.set-108"><a href="#Ghostbox.set-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="n">option_name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Ghostbox.get" class="classattr">
                                        <input id="Ghostbox.get-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">option_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">object</span>:</span></span>

                <label class="view-source-button" for="Ghostbox.get-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.get"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.get-110"><a href="#Ghostbox.get-110"><span class="linenos">110</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
</span><span id="Ghostbox.get-111"><a href="#Ghostbox.get-111"><span class="linenos">111</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">getOption</span><span class="p">(</span><span class="n">option_name</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Ghostbox.set_vars" class="classattr">
                                        <input id="Ghostbox.set_vars-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_vars</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">injections</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Self</span>:</span></span>

                <label class="view-source-button" for="Ghostbox.set_vars-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.set_vars"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.set_vars-113"><a href="#Ghostbox.set_vars-113"><span class="linenos">113</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">injections</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="Ghostbox.set_vars-114"><a href="#Ghostbox.set_vars-114"><span class="linenos">114</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">injections</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Ghostbox.set_vars-115"><a href="#Ghostbox.set_vars-115"><span class="linenos">115</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">setVar</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="Ghostbox.set_vars-116"><a href="#Ghostbox.set_vars-116"><span class="linenos">116</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


    

                            </div>
                            <div id="Ghostbox.is_busy" class="classattr">
                                        <input id="Ghostbox.is_busy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_busy</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="Ghostbox.is_busy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.is_busy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.is_busy-132"><a href="#Ghostbox.is_busy-132"><span class="linenos">132</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_busy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Ghostbox.is_busy-133"><a href="#Ghostbox.is_busy-133"><span class="linenos">133</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns true if an interaction with a backend is currently in progress.</span>
</span><span id="Ghostbox.is_busy-134"><a href="#Ghostbox.is_busy-134"><span class="linenos">134</span></a><span class="sd">        While busy, all changes to the state of options (e.g. via set or the options context manager) will be buffered and applied when the ghostbox is no longer busy.</span>
</span><span id="Ghostbox.is_busy-135"><a href="#Ghostbox.is_busy-135"><span class="linenos">135</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox.is_busy-136"><a href="#Ghostbox.is_busy-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">_frozen</span>
</span></pre></div>


            <div class="docstring"><p>Returns true if an interaction with a backend is currently in progress.
While busy, all changes to the state of options (e.g. via set or the options context manager) will be buffered and applied when the ghostbox is no longer busy.</p>
</div>


                            </div>
                            <div id="Ghostbox.timings" class="classattr">
                                        <input id="Ghostbox.timings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">timings</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#Timings">Timings</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Ghostbox.timings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.timings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.timings-138"><a href="#Ghostbox.timings-138"><span class="linenos">138</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">timings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Timings</span><span class="p">]:</span>
</span><span id="Ghostbox.timings-139"><a href="#Ghostbox.timings-139"><span class="linenos">139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provides timing and usage statistics for the last request to the backend.</span>
</span><span id="Ghostbox.timings-140"><a href="#Ghostbox.timings-140"><span class="linenos">140</span></a><span class="sd">        Returns none if no timings are available, which may happen if either no request has been sent yet, or the backend doesn&#39;t support timing.</span>
</span><span id="Ghostbox.timings-141"><a href="#Ghostbox.timings-141"><span class="linenos">141</span></a><span class="sd">        :return: Either None or an object with timing statistics.</span>
</span><span id="Ghostbox.timings-142"><a href="#Ghostbox.timings-142"><span class="linenos">142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox.timings-143"><a href="#Ghostbox.timings-143"><span class="linenos">143</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">getBackend</span><span class="p">()</span><span class="o">.</span><span class="n">timings</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Provides timing and usage statistics for the last request to the backend.
Returns none if no timings are available, which may happen if either no request has been sent yet, or the backend doesn't support timing.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Either None or an object with timing statistics.</p>
</blockquote>
</div>


                            </div>
                            <div id="Ghostbox.text" class="classattr">
                                        <input id="Ghostbox.text-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">text</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prompt_text</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="Ghostbox.text-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.text"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.text-146"><a href="#Ghostbox.text-146"><span class="linenos">146</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">text</span><span class="p">(</span>
</span><span id="Ghostbox.text-147"><a href="#Ghostbox.text-147"><span class="linenos">147</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Ghostbox.text-148"><a href="#Ghostbox.text-148"><span class="linenos">148</span></a>        <span class="n">prompt_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Ghostbox.text-149"><a href="#Ghostbox.text-149"><span class="linenos">149</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Ghostbox.text-150"><a href="#Ghostbox.text-150"><span class="linenos">150</span></a>        <span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="Ghostbox.text-151"><a href="#Ghostbox.text-151"><span class="linenos">151</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Ghostbox.text-152"><a href="#Ghostbox.text-152"><span class="linenos">152</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate text based on a prompt.</span>
</span><span id="Ghostbox.text-153"><a href="#Ghostbox.text-153"><span class="linenos">153</span></a><span class="sd">        This function blocks until either the generation finishes, or a provided timeout is reached.</span>
</span><span id="Ghostbox.text-154"><a href="#Ghostbox.text-154"><span class="linenos">154</span></a><span class="sd">        :param prompt_text: The prompt given to the LLM backend.</span>
</span><span id="Ghostbox.text-155"><a href="#Ghostbox.text-155"><span class="linenos">155</span></a><span class="sd">        :param timeout: Number of seconds to wait before the generation is canceled.</span>
</span><span id="Ghostbox.text-156"><a href="#Ghostbox.text-156"><span class="linenos">156</span></a><span class="sd">        :param options: Additional options to pass to ghostbox and possibly the backend, e.g. `{&quot;min_p&quot;: 0.01}`. This is an alternative to the `with options` context manager.</span>
</span><span id="Ghostbox.text-157"><a href="#Ghostbox.text-157"><span class="linenos">157</span></a><span class="sd">        :return: A string that was generated by the backend, based on the provided prompt.</span>
</span><span id="Ghostbox.text-158"><a href="#Ghostbox.text-158"><span class="linenos">158</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox.text-159"><a href="#Ghostbox.text-159"><span class="linenos">159</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="Ghostbox.text-160"><a href="#Ghostbox.text-160"><span class="linenos">160</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">interactBlocking</span><span class="p">(</span><span class="n">prompt_text</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generate text based on a prompt.
This function blocks until either the generation finishes, or a provided timeout is reached.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>prompt_text</strong>:  The prompt given to the LLM backend.</li>
<li><strong>timeout</strong>:  Number of seconds to wait before the generation is canceled.</li>
<li>**options: Additional options to pass to ghostbox and possibly the backend, e.g. <code>{"min_p"**:  0.01}</code>. This is an alternative to the <code>with options</code> context manager.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A string that was generated by the backend, based on the provided prompt.</p>
</blockquote>
</div>


                            </div>
                            <div id="Ghostbox.text_async" class="classattr">
                                        <input id="Ghostbox.text_async-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">text_async</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prompt_text</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span>,</span><span class="param">	<span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Ghostbox.text_async-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.text_async"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.text_async-162"><a href="#Ghostbox.text_async-162"><span class="linenos">162</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">text_async</span><span class="p">(</span>
</span><span id="Ghostbox.text_async-163"><a href="#Ghostbox.text_async-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Ghostbox.text_async-164"><a href="#Ghostbox.text_async-164"><span class="linenos">164</span></a>        <span class="n">prompt_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Ghostbox.text_async-165"><a href="#Ghostbox.text_async-165"><span class="linenos">165</span></a>        <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="Ghostbox.text_async-166"><a href="#Ghostbox.text_async-166"><span class="linenos">166</span></a>        <span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="Ghostbox.text_async-167"><a href="#Ghostbox.text_async-167"><span class="linenos">167</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Ghostbox.text_async-168"><a href="#Ghostbox.text_async-168"><span class="linenos">168</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate text based on a prompt asynchronously.</span>
</span><span id="Ghostbox.text_async-169"><a href="#Ghostbox.text_async-169"><span class="linenos">169</span></a><span class="sd">        This function does not block. It returns immediately and calls the provided callback when the generation finishes.</span>
</span><span id="Ghostbox.text_async-170"><a href="#Ghostbox.text_async-170"><span class="linenos">170</span></a><span class="sd">        :param prompt_text: The prompt given to the LLM backend.</span>
</span><span id="Ghostbox.text_async-171"><a href="#Ghostbox.text_async-171"><span class="linenos">171</span></a><span class="sd">        :param callback: A function that accepts a string. This will be called when the generation finishes, with the generated string as the only parameter.</span>
</span><span id="Ghostbox.text_async-172"><a href="#Ghostbox.text_async-172"><span class="linenos">172</span></a><span class="sd">        :param options: Additional options to pass to ghostbox and possibly the backend, e.g. `{&quot;min_p&quot;: 0.01}`. This is an alternative to the `with options` context manager.</span>
</span><span id="Ghostbox.text_async-173"><a href="#Ghostbox.text_async-173"><span class="linenos">173</span></a><span class="sd">        :return: The ghostbox instance.</span>
</span><span id="Ghostbox.text_async-174"><a href="#Ghostbox.text_async-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox.text_async-175"><a href="#Ghostbox.text_async-175"><span class="linenos">175</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="Ghostbox.text_async-176"><a href="#Ghostbox.text_async-176"><span class="linenos">176</span></a>            <span class="c1"># FIXME: this is tricky as we immediately return and set stream = True again ??? what to do</span>
</span><span id="Ghostbox.text_async-177"><a href="#Ghostbox.text_async-177"><span class="linenos">177</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">prompt_text</span><span class="p">,</span> <span class="n">user_generation_callback</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>
</span><span id="Ghostbox.text_async-178"><a href="#Ghostbox.text_async-178"><span class="linenos">178</span></a>        <span class="k">return</span>
</span></pre></div>


            <div class="docstring"><p>Generate text based on a prompt asynchronously.
This function does not block. It returns immediately and calls the provided callback when the generation finishes.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>prompt_text</strong>:  The prompt given to the LLM backend.</li>
<li><strong>callback</strong>:  A function that accepts a string. This will be called when the generation finishes, with the generated string as the only parameter.</li>
<li>**options: Additional options to pass to ghostbox and possibly the backend, e.g. <code>{"min_p"**:  0.01}</code>. This is an alternative to the <code>with options</code> context manager.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The ghostbox instance.</p>
</blockquote>
</div>


                            </div>
                            <div id="Ghostbox.text_stream" class="classattr">
                                        <input id="Ghostbox.text_stream-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">text_stream</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prompt_text</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">chunk_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span>,</span><span class="param">	<span class="n">generation_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">Ghostbox</span><span class="o">.&lt;</span><span class="k">lambda</span><span class="o">&gt;&gt;</span>,</span><span class="param">	<span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Ghostbox.text_stream-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.text_stream"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.text_stream-180"><a href="#Ghostbox.text_stream-180"><span class="linenos">180</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">text_stream</span><span class="p">(</span>
</span><span id="Ghostbox.text_stream-181"><a href="#Ghostbox.text_stream-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Ghostbox.text_stream-182"><a href="#Ghostbox.text_stream-182"><span class="linenos">182</span></a>        <span class="n">prompt_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Ghostbox.text_stream-183"><a href="#Ghostbox.text_stream-183"><span class="linenos">183</span></a>        <span class="n">chunk_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="Ghostbox.text_stream-184"><a href="#Ghostbox.text_stream-184"><span class="linenos">184</span></a>        <span class="n">generation_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Ghostbox.text_stream-185"><a href="#Ghostbox.text_stream-185"><span class="linenos">185</span></a>        <span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="Ghostbox.text_stream-186"><a href="#Ghostbox.text_stream-186"><span class="linenos">186</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Ghostbox.text_stream-187"><a href="#Ghostbox.text_stream-187"><span class="linenos">187</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate text based on a prompt and stream the response.</span>
</span><span id="Ghostbox.text_stream-188"><a href="#Ghostbox.text_stream-188"><span class="linenos">188</span></a><span class="sd">        This function does not block. It returns immediately and invokes the provided callbacks when their respective events procure.</span>
</span><span id="Ghostbox.text_stream-189"><a href="#Ghostbox.text_stream-189"><span class="linenos">189</span></a><span class="sd">        :param prompt_text: The prompt given to the LLM backend.</span>
</span><span id="Ghostbox.text_stream-190"><a href="#Ghostbox.text_stream-190"><span class="linenos">190</span></a><span class="sd">        :param chunk_callback: This is called for each token that the backend generates, with the token as sole parameter.</span>
</span><span id="Ghostbox.text_stream-191"><a href="#Ghostbox.text_stream-191"><span class="linenos">191</span></a><span class="sd">        :param generation_callback: This is called exactly once, upon completion of the response, with the entire generation as sole parameter. If you are thinking of concatenating all the tokens in chunk_callback, use this instead.</span>
</span><span id="Ghostbox.text_stream-192"><a href="#Ghostbox.text_stream-192"><span class="linenos">192</span></a><span class="sd">        :param options: Additional options to pass to ghostbox and possibly the backend, e.g. `{&quot;min_p&quot;: 0.01}`. This is an alternative to the `with options` context manager.</span>
</span><span id="Ghostbox.text_stream-193"><a href="#Ghostbox.text_stream-193"><span class="linenos">193</span></a><span class="sd">        :return: The ghostbox instance.</span>
</span><span id="Ghostbox.text_stream-194"><a href="#Ghostbox.text_stream-194"><span class="linenos">194</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox.text_stream-195"><a href="#Ghostbox.text_stream-195"><span class="linenos">195</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="Ghostbox.text_stream-196"><a href="#Ghostbox.text_stream-196"><span class="linenos">196</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span>
</span><span id="Ghostbox.text_stream-197"><a href="#Ghostbox.text_stream-197"><span class="linenos">197</span></a>                <span class="n">prompt_text</span><span class="p">,</span>
</span><span id="Ghostbox.text_stream-198"><a href="#Ghostbox.text_stream-198"><span class="linenos">198</span></a>                <span class="n">user_generation_callback</span><span class="o">=</span><span class="n">generation_callback</span><span class="p">,</span>
</span><span id="Ghostbox.text_stream-199"><a href="#Ghostbox.text_stream-199"><span class="linenos">199</span></a>                <span class="n">stream_callback</span><span class="o">=</span><span class="n">chunk_callback</span><span class="p">,</span>
</span><span id="Ghostbox.text_stream-200"><a href="#Ghostbox.text_stream-200"><span class="linenos">200</span></a>            <span class="p">)</span>
</span><span id="Ghostbox.text_stream-201"><a href="#Ghostbox.text_stream-201"><span class="linenos">201</span></a>        <span class="k">return</span>
</span></pre></div>


            <div class="docstring"><p>Generate text based on a prompt and stream the response.
This function does not block. It returns immediately and invokes the provided callbacks when their respective events procure.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>prompt_text</strong>:  The prompt given to the LLM backend.</li>
<li><strong>chunk_callback</strong>:  This is called for each token that the backend generates, with the token as sole parameter.</li>
<li><strong>generation_callback</strong>:  This is called exactly once, upon completion of the response, with the entire generation as sole parameter. If you are thinking of concatenating all the tokens in chunk_callback, use this instead.</li>
<li>**options: Additional options to pass to ghostbox and possibly the backend, e.g. <code>{"min_p"**:  0.01}</code>. This is an alternative to the <code>with options</code> context manager.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The ghostbox instance.</p>
</blockquote>
</div>


                            </div>
                            <div id="Ghostbox.json" class="classattr">
                                        <input id="Ghostbox.json-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">json</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prompt_text</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="Ghostbox.json-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.json"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.json-209"><a href="#Ghostbox.json-209"><span class="linenos">209</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">json</span><span class="p">(</span>
</span><span id="Ghostbox.json-210"><a href="#Ghostbox.json-210"><span class="linenos">210</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Ghostbox.json-211"><a href="#Ghostbox.json-211"><span class="linenos">211</span></a>        <span class="n">prompt_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Ghostbox.json-212"><a href="#Ghostbox.json-212"><span class="linenos">212</span></a>        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Ghostbox.json-213"><a href="#Ghostbox.json-213"><span class="linenos">213</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Ghostbox.json-214"><a href="#Ghostbox.json-214"><span class="linenos">214</span></a>        <span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="Ghostbox.json-215"><a href="#Ghostbox.json-215"><span class="linenos">215</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Ghostbox.json-216"><a href="#Ghostbox.json-216"><span class="linenos">216</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a prompt, returns structured output as a string that is json deserializable.</span>
</span><span id="Ghostbox.json-217"><a href="#Ghostbox.json-217"><span class="linenos">217</span></a><span class="sd">        Output is structured but somewhat unpredictable, unless you provide a json schema. If you are thinking about using pydantic objects and using their model_json_schema method, consider using the ghostbox.new method directly.</span>
</span><span id="Ghostbox.json-218"><a href="#Ghostbox.json-218"><span class="linenos">218</span></a><span class="sd">        :param prompt_text: The prompt text as natural language.</span>
</span><span id="Ghostbox.json-219"><a href="#Ghostbox.json-219"><span class="linenos">219</span></a><span class="sd">        :param schema: A dict representing a json schema, which will further restrict the generation.</span>
</span><span id="Ghostbox.json-220"><a href="#Ghostbox.json-220"><span class="linenos">220</span></a><span class="sd">        :param timeout: Number of seconds to wait before generation is canceled.</span>
</span><span id="Ghostbox.json-221"><a href="#Ghostbox.json-221"><span class="linenos">221</span></a><span class="sd">        :param options: Additional options that will be passed to the backend, e.g. `{&quot;min_p&quot;: 0.01}`.</span>
</span><span id="Ghostbox.json-222"><a href="#Ghostbox.json-222"><span class="linenos">222</span></a><span class="sd">        :return: A string that contains json, hopefully adequately satisfying the prompt.</span>
</span><span id="Ghostbox.json-223"><a href="#Ghostbox.json-223"><span class="linenos">223</span></a><span class="sd">        Example use:</span>
</span><span id="Ghostbox.json-224"><a href="#Ghostbox.json-224"><span class="linenos">224</span></a><span class="sd">        noises = json.loads(box.json(&quot;Can you list some animal noises? Please give key/value pairs.&quot;))</span>
</span><span id="Ghostbox.json-225"><a href="#Ghostbox.json-225"><span class="linenos">225</span></a><span class="sd">        noises is now e.g. {&quot;dog&quot;: &quot;woof&quot;, &quot;cat&quot;:&quot;meow&quot;, ...}</span>
</span><span id="Ghostbox.json-226"><a href="#Ghostbox.json-226"><span class="linenos">226</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox.json-227"><a href="#Ghostbox.json-227"><span class="linenos">227</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">response_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_json_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="Ghostbox.json-228"><a href="#Ghostbox.json-228"><span class="linenos">228</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">prompt_text</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Given a prompt, returns structured output as a string that is json deserializable.
Output is structured but somewhat unpredictable, unless you provide a json schema. If you are thinking about using pydantic objects and using their model_json_schema method, consider using the ghostbox.new method directly.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>prompt_text</strong>:  The prompt text as natural language.</li>
<li><strong>schema</strong>:  A dict representing a json schema, which will further restrict the generation.</li>
<li><strong>timeout</strong>:  Number of seconds to wait before generation is canceled.</li>
<li>**options: Additional options that will be passed to the backend, e.g. <code>{"min_p"**:  0.01}</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A string that contains json, hopefully adequately satisfying the prompt.
  Example use:
  noises = json.loads(box.json("Can you list some animal noises? Please give key/value pairs."))
  noises is now e.g. {"dog": "woof", "cat":"meow", ...}</p>
</blockquote>
</div>


                            </div>
                            <div id="Ghostbox.json_async" class="classattr">
                                        <input id="Ghostbox.json_async-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">json_async</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prompt_text</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span>,</span><span class="param">	<span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Ghostbox.json_async-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.json_async"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.json_async-230"><a href="#Ghostbox.json_async-230"><span class="linenos">230</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">json_async</span><span class="p">(</span>
</span><span id="Ghostbox.json_async-231"><a href="#Ghostbox.json_async-231"><span class="linenos">231</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Ghostbox.json_async-232"><a href="#Ghostbox.json_async-232"><span class="linenos">232</span></a>        <span class="n">prompt_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Ghostbox.json_async-233"><a href="#Ghostbox.json_async-233"><span class="linenos">233</span></a>        <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">dict</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="Ghostbox.json_async-234"><a href="#Ghostbox.json_async-234"><span class="linenos">234</span></a>        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Ghostbox.json_async-235"><a href="#Ghostbox.json_async-235"><span class="linenos">235</span></a>        <span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="Ghostbox.json_async-236"><a href="#Ghostbox.json_async-236"><span class="linenos">236</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Ghostbox.json_async-237"><a href="#Ghostbox.json_async-237"><span class="linenos">237</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;This is an asyncrhonous version of the json method. See its documentation for more. This method returns nothing but expects an additional callback parameter, which will be called with the generated json string as argument once the backend is done generating.</span>
</span><span id="Ghostbox.json_async-238"><a href="#Ghostbox.json_async-238"><span class="linenos">238</span></a><span class="sd">        This function does not block, but returns immediately.&quot;&quot;&quot;</span>
</span><span id="Ghostbox.json_async-239"><a href="#Ghostbox.json_async-239"><span class="linenos">239</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">response_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_json_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">),</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="Ghostbox.json_async-240"><a href="#Ghostbox.json_async-240"><span class="linenos">240</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">text_async</span><span class="p">(</span><span class="n">prompt_text</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>
</span><span id="Ghostbox.json_async-241"><a href="#Ghostbox.json_async-241"><span class="linenos">241</span></a>        <span class="k">return</span>
</span></pre></div>


            <div class="docstring"><p>This is an asyncrhonous version of the json method. See its documentation for more. This method returns nothing but expects an additional callback parameter, which will be called with the generated json string as argument once the backend is done generating.
This function does not block, but returns immediately.</p>
</div>


                            </div>
                            <div id="Ghostbox.new" class="classattr">
                                        <input id="Ghostbox.new-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">new</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">pydantic_class</span>,</span><span class="param">	<span class="n">text_prompt</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="Ghostbox.new-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.new"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.new-243"><a href="#Ghostbox.new-243"><span class="linenos">243</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">new</span><span class="p">(</span>
</span><span id="Ghostbox.new-244"><a href="#Ghostbox.new-244"><span class="linenos">244</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Ghostbox.new-245"><a href="#Ghostbox.new-245"><span class="linenos">245</span></a>        <span class="n">pydantic_class</span><span class="p">,</span>
</span><span id="Ghostbox.new-246"><a href="#Ghostbox.new-246"><span class="linenos">246</span></a>        <span class="n">text_prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Ghostbox.new-247"><a href="#Ghostbox.new-247"><span class="linenos">247</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Ghostbox.new-248"><a href="#Ghostbox.new-248"><span class="linenos">248</span></a>        <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Ghostbox.new-249"><a href="#Ghostbox.new-249"><span class="linenos">249</span></a>        <span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
</span><span id="Ghostbox.new-250"><a href="#Ghostbox.new-250"><span class="linenos">250</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="Ghostbox.new-251"><a href="#Ghostbox.new-251"><span class="linenos">251</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a subclass of pydantic.BaseModel, returns a python object of that type, with its fields filled in by the LLM backend with adherence to a given text prompt.</span>
</span><span id="Ghostbox.new-252"><a href="#Ghostbox.new-252"><span class="linenos">252</span></a><span class="sd">        This function will block until either generation finishes or a provided timeout is reached.</span>
</span><span id="Ghostbox.new-253"><a href="#Ghostbox.new-253"><span class="linenos">253</span></a><span class="sd">        This function may raise a pydantic error if the object cannot be validated. Although the LLM will be forced to adhere to the pydantic data model, this can still happen occasionally, for example, in the case of refusals. Either use the retries argument, or wrap a call to new in a try block accordingly.</span>
</span><span id="Ghostbox.new-254"><a href="#Ghostbox.new-254"><span class="linenos">254</span></a><span class="sd">        :param pydantic_class: The type of object that should be created.</span>
</span><span id="Ghostbox.new-255"><a href="#Ghostbox.new-255"><span class="linenos">255</span></a><span class="sd">        :param text_prompt: Prompt given to the LLM that should aid in object creation. This will influence how the pydantic object&#39;s fields will be filled in. Depending on the model used, certain prompts may lead to refusal, even with object creation, so be careful.</span>
</span><span id="Ghostbox.new-256"><a href="#Ghostbox.new-256"><span class="linenos">256</span></a><span class="sd">        :param timeout: A timeout in seconds after which generation is canceled.</span>
</span><span id="Ghostbox.new-257"><a href="#Ghostbox.new-257"><span class="linenos">257</span></a><span class="sd">        :param retries: In case of a validation error, how often should the generation be retried? Since sampling, especially with temperature &gt; 0.0, is not deterministic, retries can eventually yield valid results. A value of 0 means no retries will be performed and the function raises an error on invalid data or refusal. A value of -1 means retry forever or until the timeout is reached.</span>
</span><span id="Ghostbox.new-258"><a href="#Ghostbox.new-258"><span class="linenos">258</span></a><span class="sd">        :param options: Additional options to pass to ghostbox and possibly the backend, e.g. `{&quot;min_p&quot;: 0.01}`. This is an alternative to the `with options` context manager.</span>
</span><span id="Ghostbox.new-259"><a href="#Ghostbox.new-259"><span class="linenos">259</span></a><span class="sd">        :return: A valid python object of the provided pydantic type, with its fields filled in.</span>
</span><span id="Ghostbox.new-260"><a href="#Ghostbox.new-260"><span class="linenos">260</span></a>
</span><span id="Ghostbox.new-261"><a href="#Ghostbox.new-261"><span class="linenos">261</span></a><span class="sd">        Example:</span>
</span><span id="Ghostbox.new-262"><a href="#Ghostbox.new-262"><span class="linenos">262</span></a>
</span><span id="Ghostbox.new-263"><a href="#Ghostbox.new-263"><span class="linenos">263</span></a><span class="sd">        ## animal.py</span>
</span><span id="Ghostbox.new-264"><a href="#Ghostbox.new-264"><span class="linenos">264</span></a><span class="sd">        ```python</span>
</span><span id="Ghostbox.new-265"><a href="#Ghostbox.new-265"><span class="linenos">265</span></a><span class="sd">        from pydantic import BaseModel</span>
</span><span id="Ghostbox.new-266"><a href="#Ghostbox.new-266"><span class="linenos">266</span></a><span class="sd">        import ghostbox, json</span>
</span><span id="Ghostbox.new-267"><a href="#Ghostbox.new-267"><span class="linenos">267</span></a>
</span><span id="Ghostbox.new-268"><a href="#Ghostbox.new-268"><span class="linenos">268</span></a><span class="sd">        class Animal(BaseModel):</span>
</span><span id="Ghostbox.new-269"><a href="#Ghostbox.new-269"><span class="linenos">269</span></a><span class="sd">            name: str</span>
</span><span id="Ghostbox.new-270"><a href="#Ghostbox.new-270"><span class="linenos">270</span></a><span class="sd">            cute_name: str</span>
</span><span id="Ghostbox.new-271"><a href="#Ghostbox.new-271"><span class="linenos">271</span></a><span class="sd">            number_of_legs: int</span>
</span><span id="Ghostbox.new-272"><a href="#Ghostbox.new-272"><span class="linenos">272</span></a><span class="sd">            friendly: bool</span>
</span><span id="Ghostbox.new-273"><a href="#Ghostbox.new-273"><span class="linenos">273</span></a><span class="sd">            favorite_foods: List[str]</span>
</span><span id="Ghostbox.new-274"><a href="#Ghostbox.new-274"><span class="linenos">274</span></a>
</span><span id="Ghostbox.new-275"><a href="#Ghostbox.new-275"><span class="linenos">275</span></a><span class="sd">        box = ghostbox.from_generic(...)</span>
</span><span id="Ghostbox.new-276"><a href="#Ghostbox.new-276"><span class="linenos">276</span></a><span class="sd">        cat = box.new(Animal, &quot;Please generate a cute housecat.&quot;)</span>
</span><span id="Ghostbox.new-277"><a href="#Ghostbox.new-277"><span class="linenos">277</span></a><span class="sd">        print(json.dumps(cat.model_dump(), indent=4))</span>
</span><span id="Ghostbox.new-278"><a href="#Ghostbox.new-278"><span class="linenos">278</span></a><span class="sd">        ```</span>
</span><span id="Ghostbox.new-279"><a href="#Ghostbox.new-279"><span class="linenos">279</span></a>
</span><span id="Ghostbox.new-280"><a href="#Ghostbox.new-280"><span class="linenos">280</span></a><span class="sd">        ## Output</span>
</span><span id="Ghostbox.new-281"><a href="#Ghostbox.new-281"><span class="linenos">281</span></a>
</span><span id="Ghostbox.new-282"><a href="#Ghostbox.new-282"><span class="linenos">282</span></a><span class="sd">        ```bash</span>
</span><span id="Ghostbox.new-283"><a href="#Ghostbox.new-283"><span class="linenos">283</span></a><span class="sd">        $ python animal.py</span>
</span><span id="Ghostbox.new-284"><a href="#Ghostbox.new-284"><span class="linenos">284</span></a><span class="sd">        {</span>
</span><span id="Ghostbox.new-285"><a href="#Ghostbox.new-285"><span class="linenos">285</span></a><span class="sd">            &quot;name&quot; : &quot;Cat&quot;,</span>
</span><span id="Ghostbox.new-286"><a href="#Ghostbox.new-286"><span class="linenos">286</span></a><span class="sd">            &quot;cute_name&quot; : &quot;Dr. Kisses&quot;,</span>
</span><span id="Ghostbox.new-287"><a href="#Ghostbox.new-287"><span class="linenos">287</span></a><span class="sd">            &quot;number_of_legs&quot; : 4,</span>
</span><span id="Ghostbox.new-288"><a href="#Ghostbox.new-288"><span class="linenos">288</span></a><span class="sd">            &quot;friendly&quot; : true,</span>
</span><span id="Ghostbox.new-289"><a href="#Ghostbox.new-289"><span class="linenos">289</span></a><span class="sd">            &quot;favorite_foods&quot; : [&quot;Tuna&quot;, &quot;Cat Treats&quot;, &quot;Water from the toilet&quot;]</span>
</span><span id="Ghostbox.new-290"><a href="#Ghostbox.new-290"><span class="linenos">290</span></a><span class="sd">        }</span>
</span><span id="Ghostbox.new-291"><a href="#Ghostbox.new-291"><span class="linenos">291</span></a><span class="sd">        ```</span>
</span><span id="Ghostbox.new-292"><a href="#Ghostbox.new-292"><span class="linenos">292</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox.new-293"><a href="#Ghostbox.new-293"><span class="linenos">293</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="Ghostbox.new-294"><a href="#Ghostbox.new-294"><span class="linenos">294</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Ghostbox.new-295"><a href="#Ghostbox.new-295"><span class="linenos">295</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Ghostbox.new-296"><a href="#Ghostbox.new-296"><span class="linenos">296</span></a>                    <span class="k">return</span> <span class="n">pydantic_class</span><span class="p">(</span>
</span><span id="Ghostbox.new-297"><a href="#Ghostbox.new-297"><span class="linenos">297</span></a>                        <span class="o">**</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
</span><span id="Ghostbox.new-298"><a href="#Ghostbox.new-298"><span class="linenos">298</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">json</span><span class="p">(</span>
</span><span id="Ghostbox.new-299"><a href="#Ghostbox.new-299"><span class="linenos">299</span></a>                                <span class="n">text_prompt</span><span class="p">,</span>
</span><span id="Ghostbox.new-300"><a href="#Ghostbox.new-300"><span class="linenos">300</span></a>                                <span class="n">schema</span><span class="o">=</span><span class="n">pydantic_class</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">(),</span>
</span><span id="Ghostbox.new-301"><a href="#Ghostbox.new-301"><span class="linenos">301</span></a>                                <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
</span><span id="Ghostbox.new-302"><a href="#Ghostbox.new-302"><span class="linenos">302</span></a>                            <span class="p">)</span>
</span><span id="Ghostbox.new-303"><a href="#Ghostbox.new-303"><span class="linenos">303</span></a>                        <span class="p">)</span>
</span><span id="Ghostbox.new-304"><a href="#Ghostbox.new-304"><span class="linenos">304</span></a>                    <span class="p">)</span>
</span><span id="Ghostbox.new-305"><a href="#Ghostbox.new-305"><span class="linenos">305</span></a>                <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Ghostbox.new-306"><a href="#Ghostbox.new-306"><span class="linenos">306</span></a>                    <span class="k">if</span> <span class="n">retries</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Ghostbox.new-307"><a href="#Ghostbox.new-307"><span class="linenos">307</span></a>                        <span class="k">raise</span> <span class="n">e</span>
</span><span id="Ghostbox.new-308"><a href="#Ghostbox.new-308"><span class="linenos">308</span></a>                    <span class="n">retries</span> <span class="o">-=</span> <span class="mi">1</span>
</span></pre></div>


            <div class="docstring"><p>Given a subclass of pydantic.BaseModel, returns a python object of that type, with its fields filled in by the LLM backend with adherence to a given text prompt.
This function will block until either generation finishes or a provided timeout is reached.
This function may raise a pydantic error if the object cannot be validated. Although the LLM will be forced to adhere to the pydantic data model, this can still happen occasionally, for example, in the case of refusals. Either use the retries argument, or wrap a call to new in a try block accordingly.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>pydantic_class</strong>:  The type of object that should be created.</li>
<li><strong>text_prompt</strong>:  Prompt given to the LLM that should aid in object creation. This will influence how the pydantic object's fields will be filled in. Depending on the model used, certain prompts may lead to refusal, even with object creation, so be careful.</li>
<li><strong>timeout</strong>:  A timeout in seconds after which generation is canceled.</li>
<li><strong>retries</strong>:  In case of a validation error, how often should the generation be retried? Since sampling, especially with temperature &gt; 0.0, is not deterministic, retries can eventually yield valid results. A value of 0 means no retries will be performed and the function raises an error on invalid data or refusal. A value of -1 means retry forever or until the timeout is reached.</li>
<li>**options: Additional options to pass to ghostbox and possibly the backend, e.g. <code>{"min_p"**:  0.01}</code>. This is an alternative to the <code>with options</code> context manager.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A valid python object of the provided pydantic type, with its fields filled in.</p>
</blockquote>

<p>Example:</p>

<h2 id="animalpy">animal.py</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ghostbox</span><span class="o">,</span><span class="w"> </span><span class="nn">json</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Animal</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">cute_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">number_of_legs</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">friendly</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">favorite_foods</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

<span class="n">box</span> <span class="o">=</span> <span class="n"><a href="#from_generic">ghostbox.from_generic</a></span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">Animal</span><span class="p">,</span> <span class="s2">&quot;Please generate a cute housecat.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</code></pre>
</div>

<h2 id="output">Output</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code>$<span class="w"> </span>python<span class="w"> </span>animal.py
<span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;name&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;Cat&quot;</span>,
<span class="w">    </span><span class="s2">&quot;cute_name&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;Dr. Kisses&quot;</span>,
<span class="w">    </span><span class="s2">&quot;number_of_legs&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">4</span>,
<span class="w">    </span><span class="s2">&quot;friendly&quot;</span><span class="w"> </span>:<span class="w"> </span>true,
<span class="w">    </span><span class="s2">&quot;favorite_foods&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;Tuna&quot;</span>,<span class="w"> </span><span class="s2">&quot;Cat Treats&quot;</span>,<span class="w"> </span><span class="s2">&quot;Water from the toilet&quot;</span><span class="o">]</span>
<span class="o">}</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="Ghostbox.images" class="classattr">
                                        <input id="Ghostbox.images-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-contextmanager">@contextmanager</div>

        <span class="def">def</span>
        <span class="name">images</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">image_urls</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Ghostbox.images-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.images"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.images-311"><a href="#Ghostbox.images-311"><span class="linenos">311</span></a>    <span class="nd">@contextmanager</span>
</span><span id="Ghostbox.images-312"><a href="#Ghostbox.images-312"><span class="linenos">312</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_urls</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span><span id="Ghostbox.images-313"><a href="#Ghostbox.images-313"><span class="linenos">313</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a context in which ghostbox queries can refer to images.</span>
</span><span id="Ghostbox.images-314"><a href="#Ghostbox.images-314"><span class="linenos">314</span></a><span class="sd">        This context manager will not raise an error if an image cannot be found on the file system.</span>
</span><span id="Ghostbox.images-315"><a href="#Ghostbox.images-315"><span class="linenos">315</span></a><span class="sd">        :param image_urls: A list of either file system paths or web URLs (or both) that point to images.</span>
</span><span id="Ghostbox.images-316"><a href="#Ghostbox.images-316"><span class="linenos">316</span></a><span class="sd">        :return: A ghostbox instance.</span>
</span><span id="Ghostbox.images-317"><a href="#Ghostbox.images-317"><span class="linenos">317</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox.images-318"><a href="#Ghostbox.images-318"><span class="linenos">318</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_urls</span><span class="p">)):</span>
</span><span id="Ghostbox.images-319"><a href="#Ghostbox.images-319"><span class="linenos">319</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="n">image_urls</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Ghostbox.images-320"><a href="#Ghostbox.images-320"><span class="linenos">320</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">loadImage</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span id="Ghostbox.images-321"><a href="#Ghostbox.images-321"><span class="linenos">321</span></a>        <span class="k">yield</span> <span class="bp">self</span>
</span><span id="Ghostbox.images-322"><a href="#Ghostbox.images-322"><span class="linenos">322</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="p">{}</span>
</span></pre></div>


            <div class="docstring"><p>Creates a context in which ghostbox queries can refer to images.
This context manager will not raise an error if an image cannot be found on the file system.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>image_urls</strong>:  A list of either file system paths or web URLs (or both) that point to images.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A ghostbox instance.</p>
</blockquote>
</div>


                            </div>
                            <div id="Ghostbox.audio_start_transcription" class="classattr">
                                        <input id="Ghostbox.audio_start_transcription-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">audio_start_transcription</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">transcription_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span>,</span><span class="param">	<span class="n">threshold_activation_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">NoneType</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Ghostbox.audio_start_transcription-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.audio_start_transcription"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.audio_start_transcription-326"><a href="#Ghostbox.audio_start_transcription-326"><span class="linenos">326</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">audio_start_transcription</span><span class="p">(</span>
</span><span id="Ghostbox.audio_start_transcription-327"><a href="#Ghostbox.audio_start_transcription-327"><span class="linenos">327</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Ghostbox.audio_start_transcription-328"><a href="#Ghostbox.audio_start_transcription-328"><span class="linenos">328</span></a>        <span class="n">transcription_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="Ghostbox.audio_start_transcription-329"><a href="#Ghostbox.audio_start_transcription-329"><span class="linenos">329</span></a>        <span class="n">threshold_activation_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="Ghostbox.audio_start_transcription-330"><a href="#Ghostbox.audio_start_transcription-330"><span class="linenos">330</span></a>    <span class="p">):</span>
</span><span id="Ghostbox.audio_start_transcription-331"><a href="#Ghostbox.audio_start_transcription-331"><span class="linenos">331</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start to continuously record and transcribe audio above a certain threshold.</span>
</span><span id="Ghostbox.audio_start_transcription-332"><a href="#Ghostbox.audio_start_transcription-332"><span class="linenos">332</span></a><span class="sd">        This method is for rolling your own transcriber. If you want to simply have the ghostbox react to a user saying things, just use the &quot;audio&quot;=True option. E.g.</span>
</span><span id="Ghostbox.audio_start_transcription-333"><a href="#Ghostbox.audio_start_transcription-333"><span class="linenos">333</span></a><span class="sd">        ```</span>
</span><span id="Ghostbox.audio_start_transcription-334"><a href="#Ghostbox.audio_start_transcription-334"><span class="linenos">334</span></a><span class="sd">        box = ghostbox.from_generic(character_folder=&quot;some_helpful_assistant&quot;,</span>
</span><span id="Ghostbox.audio_start_transcription-335"><a href="#Ghostbox.audio_start_transcription-335"><span class="linenos">335</span></a><span class="sd">            audio=True)</span>
</span><span id="Ghostbox.audio_start_transcription-336"><a href="#Ghostbox.audio_start_transcription-336"><span class="linenos">336</span></a><span class="sd">        while True:</span>
</span><span id="Ghostbox.audio_start_transcription-337"><a href="#Ghostbox.audio_start_transcription-337"><span class="linenos">337</span></a><span class="sd">            # the box will be transcribing and answering the transcribed text on a seperate thread</span>
</span><span id="Ghostbox.audio_start_transcription-338"><a href="#Ghostbox.audio_start_transcription-338"><span class="linenos">338</span></a><span class="sd">            # as if you had called box.text with the transcription</span>
</span><span id="Ghostbox.audio_start_transcription-339"><a href="#Ghostbox.audio_start_transcription-339"><span class="linenos">339</span></a><span class="sd">            # (provided silence threshold and activation phrase are met and given)</span>
</span><span id="Ghostbox.audio_start_transcription-340"><a href="#Ghostbox.audio_start_transcription-340"><span class="linenos">340</span></a><span class="sd">            # so we idle here</span>
</span><span id="Ghostbox.audio_start_transcription-341"><a href="#Ghostbox.audio_start_transcription-341"><span class="linenos">341</span></a><span class="sd">            time.sleep(0.3)</span>
</span><span id="Ghostbox.audio_start_transcription-342"><a href="#Ghostbox.audio_start_transcription-342"><span class="linenos">342</span></a><span class="sd">        ```</span>
</span><span id="Ghostbox.audio_start_transcription-343"><a href="#Ghostbox.audio_start_transcription-343"><span class="linenos">343</span></a>
</span><span id="Ghostbox.audio_start_transcription-344"><a href="#Ghostbox.audio_start_transcription-344"><span class="linenos">344</span></a><span class="sd">        You can configure this transcriber with the options context manager. See the various audio_* options for more. Especially the audio_silence_threshold may be interesting.</span>
</span><span id="Ghostbox.audio_start_transcription-345"><a href="#Ghostbox.audio_start_transcription-345"><span class="linenos">345</span></a><span class="sd">        If the transcription seems to do nothing, make sure the threshold is low enough and that no activation phrase is set.</span>
</span><span id="Ghostbox.audio_start_transcription-346"><a href="#Ghostbox.audio_start_transcription-346"><span class="linenos">346</span></a><span class="sd">        :param transcription_callback: A function that will be called whenever a successful transcription was made. For a transcription to be successful, three conditions must be met: 1. The microhphone must record sound above the activation threshold. 2. If an activation phrase is set, a fuzzy version of the phrase must be found in the transcription. 3. The recording must eventually register audio below the silence threshold again, ending the transcription. If all things are true, the callback will be invoked with the finished transcription. Note that this can be quiet a long time (tens of seconds) away from the beginning of recording.</span>
</span><span id="Ghostbox.audio_start_transcription-347"><a href="#Ghostbox.audio_start_transcription-347"><span class="linenos">347</span></a><span class="sd">        :param activation_callback: This function will be called whenever the audio recording goes above the silence threshold. It is called immediately when transcription begins. This is useful, if e.g. you are trying to build a responsive AI that stops the tts instantly when the user speaks.</span>
</span><span id="Ghostbox.audio_start_transcription-348"><a href="#Ghostbox.audio_start_transcription-348"><span class="linenos">348</span></a><span class="sd">        :return: The ghostbox instance.</span>
</span><span id="Ghostbox.audio_start_transcription-349"><a href="#Ghostbox.audio_start_transcription-349"><span class="linenos">349</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox.audio_start_transcription-350"><a href="#Ghostbox.audio_start_transcription-350"><span class="linenos">350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">audio_stop_transcription</span><span class="p">()</span>
</span><span id="Ghostbox.audio_start_transcription-351"><a href="#Ghostbox.audio_start_transcription-351"><span class="linenos">351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">whisper</span><span class="o">.</span><span class="n">transcribeContinuously</span><span class="p">(</span>
</span><span id="Ghostbox.audio_start_transcription-352"><a href="#Ghostbox.audio_start_transcription-352"><span class="linenos">352</span></a>            <span class="n">callback</span><span class="o">=</span><span class="n">transcription_callback</span><span class="p">,</span>
</span><span id="Ghostbox.audio_start_transcription-353"><a href="#Ghostbox.audio_start_transcription-353"><span class="linenos">353</span></a>            <span class="n">on_threshold</span><span class="o">=</span><span class="n">threshold_activation_callback</span><span class="p">,</span>
</span><span id="Ghostbox.audio_start_transcription-354"><a href="#Ghostbox.audio_start_transcription-354"><span class="linenos">354</span></a>            <span class="n">websock</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">getOption</span><span class="p">(</span><span class="s2">&quot;audio_websock&quot;</span><span class="p">),</span>
</span><span id="Ghostbox.audio_start_transcription-355"><a href="#Ghostbox.audio_start_transcription-355"><span class="linenos">355</span></a>            <span class="n">websock_host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">getOption</span><span class="p">(</span><span class="s2">&quot;audio_websock_host&quot;</span><span class="p">),</span>
</span><span id="Ghostbox.audio_start_transcription-356"><a href="#Ghostbox.audio_start_transcription-356"><span class="linenos">356</span></a>            <span class="n">websock_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">getOption</span><span class="p">(</span><span class="s2">&quot;audio_websock_port&quot;</span><span class="p">),</span>
</span><span id="Ghostbox.audio_start_transcription-357"><a href="#Ghostbox.audio_start_transcription-357"><span class="linenos">357</span></a>            <span class="n">silence_threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">getOption</span><span class="p">(</span><span class="s2">&quot;audio_silence_threshold&quot;</span><span class="p">),</span>
</span><span id="Ghostbox.audio_start_transcription-358"><a href="#Ghostbox.audio_start_transcription-358"><span class="linenos">358</span></a>        <span class="p">)</span>
</span><span id="Ghostbox.audio_start_transcription-359"><a href="#Ghostbox.audio_start_transcription-359"><span class="linenos">359</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Start to continuously record and transcribe audio above a certain threshold.
This method is for rolling your own transcriber. If you want to simply have the ghostbox react to a user saying things, just use the "audio"=True option. E.g.</p>

<pre><code>box = <a href="#from_generic">ghostbox.from_generic</a>(character_folder="some_helpful_assistant",
    audio=True)
while True:
    # the box will be transcribing and answering the transcribed text on a seperate thread
    # as if you had called box.text with the transcription
    # (provided silence threshold and activation phrase are met and given)
    # so we idle here
    time.sleep(0.3)
</code></pre>

<p>You can configure this transcriber with the options context manager. See the various audio_* options for more. Especially the audio_silence_threshold may be interesting.
If the transcription seems to do nothing, make sure the threshold is low enough and that no activation phrase is set.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>transcription_callback: A function that will be called whenever a successful transcription was made. For a transcription to be successful, three conditions must be met</strong>:  1. The microhphone must record sound above the activation threshold. 2. If an activation phrase is set, a fuzzy version of the phrase must be found in the transcription. 3. The recording must eventually register audio below the silence threshold again, ending the transcription. If all things are true, the callback will be invoked with the finished transcription. Note that this can be quiet a long time (tens of seconds) away from the beginning of recording.</li>
<li><strong>activation_callback</strong>:  This function will be called whenever the audio recording goes above the silence threshold. It is called immediately when transcription begins. This is useful, if e.g. you are trying to build a responsive AI that stops the tts instantly when the user speaks.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The ghostbox instance.</p>
</blockquote>
</div>


                            </div>
                            <div id="Ghostbox.audio_stop_transcription" class="classattr">
                                        <input id="Ghostbox.audio_stop_transcription-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">audio_stop_transcription</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Ghostbox.audio_stop_transcription-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.audio_stop_transcription"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.audio_stop_transcription-361"><a href="#Ghostbox.audio_stop_transcription-361"><span class="linenos">361</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">audio_stop_transcription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Ghostbox.audio_stop_transcription-362"><a href="#Ghostbox.audio_stop_transcription-362"><span class="linenos">362</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stops an ongoing continuous transcription.&quot;&quot;&quot;</span>
</span><span id="Ghostbox.audio_stop_transcription-363"><a href="#Ghostbox.audio_stop_transcription-363"><span class="linenos">363</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ct</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Ghostbox.audio_stop_transcription-364"><a href="#Ghostbox.audio_stop_transcription-364"><span class="linenos">364</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ct</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Stops an ongoing continuous transcription.</p>
</div>


                            </div>
                            <div id="Ghostbox.start_session" class="classattr">
                                        <input id="Ghostbox.start_session-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start_session</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">keep</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Self</span>:</span></span>

                <label class="view-source-button" for="Ghostbox.start_session-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.start_session"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.start_session-368"><a href="#Ghostbox.start_session-368"><span class="linenos">368</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="Ghostbox.start_session-369"><a href="#Ghostbox.start_session-369"><span class="linenos">369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start a completely new session with a given character folder.</span>
</span><span id="Ghostbox.start_session-370"><a href="#Ghostbox.start_session-370"><span class="linenos">370</span></a><span class="sd">        This function wipes all history and context variables. It&#39;s a clean slate. If you want to switch characters while retaining context, use set_char instead.</span>
</span><span id="Ghostbox.start_session-371"><a href="#Ghostbox.start_session-371"><span class="linenos">371</span></a><span class="sd">        :param filepath: Path to a character folder.</span>
</span><span id="Ghostbox.start_session-372"><a href="#Ghostbox.start_session-372"><span class="linenos">372</span></a><span class="sd">        :return: The ghostbox instance.</span>
</span><span id="Ghostbox.start_session-373"><a href="#Ghostbox.start_session-373"><span class="linenos">373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox.start_session-374"><a href="#Ghostbox.start_session-374"><span class="linenos">374</span></a>        <span class="n">printerr</span><span class="p">(</span><span class="n">start_session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="p">,</span> <span class="n">filepath</span><span class="p">))</span>
</span><span id="Ghostbox.start_session-375"><a href="#Ghostbox.start_session-375"><span class="linenos">375</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Start a completely new session with a given character folder.
This function wipes all history and context variables. It's a clean slate. If you want to switch characters while retaining context, use set_char instead.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>filepath</strong>:  Path to a character folder.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The ghostbox instance.</p>
</blockquote>
</div>


                            </div>
                            <div id="Ghostbox.load_config" class="classattr">
                                        <input id="Ghostbox.load_config-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_config</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">config_file</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Self</span>:</span></span>

                <label class="view-source-button" for="Ghostbox.load_config-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.load_config"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.load_config-377"><a href="#Ghostbox.load_config-377"><span class="linenos">377</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="Ghostbox.load_config-378"><a href="#Ghostbox.load_config-378"><span class="linenos">378</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads a config file and applies the option/value pairs in it to this ghostbox instance.</span>
</span><span id="Ghostbox.load_config-379"><a href="#Ghostbox.load_config-379"><span class="linenos">379</span></a><span class="sd">        A config file contains a valid json string that describes an options dictionary.</span>
</span><span id="Ghostbox.load_config-380"><a href="#Ghostbox.load_config-380"><span class="linenos">380</span></a><span class="sd">        Configs loaded this way are intended to be user profiles or similar. AI character folders have their own config.json files that, by convention, are loaded automatically. If you want to simply configure an AI char, you should use their dedicated config file as it generally does *the right thing* when it comes to annoying stuff of overriding options and option precedence etc.</span>
</span><span id="Ghostbox.load_config-381"><a href="#Ghostbox.load_config-381"><span class="linenos">381</span></a><span class="sd">        Example:</span>
</span><span id="Ghostbox.load_config-382"><a href="#Ghostbox.load_config-382"><span class="linenos">382</span></a>
</span><span id="Ghostbox.load_config-383"><a href="#Ghostbox.load_config-383"><span class="linenos">383</span></a><span class="sd">        ## alice_config.json</span>
</span><span id="Ghostbox.load_config-384"><a href="#Ghostbox.load_config-384"><span class="linenos">384</span></a>
</span><span id="Ghostbox.load_config-385"><a href="#Ghostbox.load_config-385"><span class="linenos">385</span></a><span class="sd">        ```json</span>
</span><span id="Ghostbox.load_config-386"><a href="#Ghostbox.load_config-386"><span class="linenos">386</span></a><span class="sd">        {</span>
</span><span id="Ghostbox.load_config-387"><a href="#Ghostbox.load_config-387"><span class="linenos">387</span></a><span class="sd">            &quot;chat_user&quot; : &quot;alice&quot;,</span>
</span><span id="Ghostbox.load_config-388"><a href="#Ghostbox.load_config-388"><span class="linenos">388</span></a><span class="sd">            &quot;tts&quot;: true,</span>
</span><span id="Ghostbox.load_config-389"><a href="#Ghostbox.load_config-389"><span class="linenos">389</span></a><span class="sd">            &quot;tts_model&quot;: &quot;kokoro&quot;,</span>
</span><span id="Ghostbox.load_config-390"><a href="#Ghostbox.load_config-390"><span class="linenos">390</span></a><span class="sd">            &quot;tts_voice&quot;: &quot;af_sky&quot;,</span>
</span><span id="Ghostbox.load_config-391"><a href="#Ghostbox.load_config-391"><span class="linenos">391</span></a><span class="sd">            &quot;log_time&quot;: false</span>
</span><span id="Ghostbox.load_config-392"><a href="#Ghostbox.load_config-392"><span class="linenos">392</span></a><span class="sd">        }</span>
</span><span id="Ghostbox.load_config-393"><a href="#Ghostbox.load_config-393"><span class="linenos">393</span></a><span class="sd">        ```</span>
</span><span id="Ghostbox.load_config-394"><a href="#Ghostbox.load_config-394"><span class="linenos">394</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox.load_config-395"><a href="#Ghostbox.load_config-395"><span class="linenos">395</span></a>        <span class="n">printerr</span><span class="p">(</span><span class="n">load_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="p">,</span> <span class="n">config_file</span><span class="p">))</span>
</span><span id="Ghostbox.load_config-396"><a href="#Ghostbox.load_config-396"><span class="linenos">396</span></a>        <span class="c1"># FIXME: update self.__dict__?</span>
</span><span id="Ghostbox.load_config-397"><a href="#Ghostbox.load_config-397"><span class="linenos">397</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Loads a config file and applies the option/value pairs in it to this ghostbox instance.
A config file contains a valid json string that describes an options dictionary.
Configs loaded this way are intended to be user profiles or similar. AI character folders have their own config.json files that, by convention, are loaded automatically. If you want to simply configure an AI char, you should use their dedicated config file as it generally does <em>the right thing</em> when it comes to annoying stuff of overriding options and option precedence etc.
Example:</p>

<h2 id="alice_configjson">alice_config.json</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;chat_user&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alice&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tts&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tts_model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;kokoro&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tts_voice&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;af_sky&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;log_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="Ghostbox.tools_inject_dependency" class="classattr">
                                        <input id="Ghostbox.tools_inject_dependency-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tools_inject_dependency</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">symbol_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">obj</span><span class="p">:</span> <span class="nb">object</span></span><span class="return-annotation">) -> <span class="n">Self</span>:</span></span>

                <label class="view-source-button" for="Ghostbox.tools_inject_dependency-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.tools_inject_dependency"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.tools_inject_dependency-399"><a href="#Ghostbox.tools_inject_dependency-399"><span class="linenos">399</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tools_inject_dependency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="Ghostbox.tools_inject_dependency-400"><a href="#Ghostbox.tools_inject_dependency-400"><span class="linenos">400</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a python object available in the python tool module of a running ghostbox AI, without having defined it in the tools.py.</span>
</span><span id="Ghostbox.tools_inject_dependency-401"><a href="#Ghostbox.tools_inject_dependency-401"><span class="linenos">401</span></a><span class="sd">        This can be used to inject dependencies from the &#39;outside&#39;. This is useful in cases where you must make an object available to the AI that can not be acquired during initialization of the tool module, for example, a resource manager, or a network connection.</span>
</span><span id="Ghostbox.tools_inject_dependency-402"><a href="#Ghostbox.tools_inject_dependency-402"><span class="linenos">402</span></a><span class="sd">        Note that the AI will not be aware of an injected dependency, and be unable to reference it. However, you can refer to the symbol_name in the functions you define for the AI, which will be a bound reference as soon as you inject the dependency. The AI may then use the functions that previously didn&#39;t refer to the object now bound by symbol_name.</span>
</span><span id="Ghostbox.tools_inject_dependency-403"><a href="#Ghostbox.tools_inject_dependency-403"><span class="linenos">403</span></a><span class="sd">        :param symbol_name: The name of the identifier to be injected. If this is e.g. &#39;point&#39;, point will be bound to obj in tools.py.</span>
</span><span id="Ghostbox.tools_inject_dependency-404"><a href="#Ghostbox.tools_inject_dependency-404"><span class="linenos">404</span></a><span class="sd">        :param obj: An arbitrary python object. A reference to object will be bound to symbol_name and be available in tools.py.</span>
</span><span id="Ghostbox.tools_inject_dependency-405"><a href="#Ghostbox.tools_inject_dependency-405"><span class="linenos">405</span></a><span class="sd">        :return: Ghostbox</span>
</span><span id="Ghostbox.tools_inject_dependency-406"><a href="#Ghostbox.tools_inject_dependency-406"><span class="linenos">406</span></a><span class="sd">        Here&#39;s an example use of dependency injection:</span>
</span><span id="Ghostbox.tools_inject_dependency-407"><a href="#Ghostbox.tools_inject_dependency-407"><span class="linenos">407</span></a><span class="sd">        ## human_resources.py</span>
</span><span id="Ghostbox.tools_inject_dependency-408"><a href="#Ghostbox.tools_inject_dependency-408"><span class="linenos">408</span></a><span class="sd">        ```python</span>
</span><span id="Ghostbox.tools_inject_dependency-409"><a href="#Ghostbox.tools_inject_dependency-409"><span class="linenos">409</span></a><span class="sd">        box = ghostbox.from_generic(...)</span>
</span><span id="Ghostbox.tools_inject_dependency-410"><a href="#Ghostbox.tools_inject_dependency-410"><span class="linenos">410</span></a><span class="sd">        # imaginary database connection e.g.</span>
</span><span id="Ghostbox.tools_inject_dependency-411"><a href="#Ghostbox.tools_inject_dependency-411"><span class="linenos">411</span></a><span class="sd">        # we don&#39;t want this in the tools.py of employee_assistant</span>
</span><span id="Ghostbox.tools_inject_dependency-412"><a href="#Ghostbox.tools_inject_dependency-412"><span class="linenos">412</span></a><span class="sd">        database_handle = EmployeeDatabase.open_connection(user=&quot;bob&quot;, password=&quot;bruce_schneier&quot;)</span>
</span><span id="Ghostbox.tools_inject_dependency-413"><a href="#Ghostbox.tools_inject_dependency-413"><span class="linenos">413</span></a><span class="sd">        # stuff happens, maybe we start a read/evaluate loop</span>
</span><span id="Ghostbox.tools_inject_dependency-414"><a href="#Ghostbox.tools_inject_dependency-414"><span class="linenos">414</span></a><span class="sd">        # ...</span>
</span><span id="Ghostbox.tools_inject_dependency-415"><a href="#Ghostbox.tools_inject_dependency-415"><span class="linenos">415</span></a>
</span><span id="Ghostbox.tools_inject_dependency-416"><a href="#Ghostbox.tools_inject_dependency-416"><span class="linenos">416</span></a><span class="sd">        # start our assistant</span>
</span><span id="Ghostbox.tools_inject_dependency-417"><a href="#Ghostbox.tools_inject_dependency-417"><span class="linenos">417</span></a><span class="sd">        box.start_session(&quot;employee_assistant&quot;)</span>
</span><span id="Ghostbox.tools_inject_dependency-418"><a href="#Ghostbox.tools_inject_dependency-418"><span class="linenos">418</span></a><span class="sd">        #without this, the tool calls would fail</span>
</span><span id="Ghostbox.tools_inject_dependency-419"><a href="#Ghostbox.tools_inject_dependency-419"><span class="linenos">419</span></a><span class="sd">        box.tools_inject_dependency(&quot;DBHANDLE&quot;, database_handle)</span>
</span><span id="Ghostbox.tools_inject_dependency-420"><a href="#Ghostbox.tools_inject_dependency-420"><span class="linenos">420</span></a><span class="sd">        with options{use_tools=True):</span>
</span><span id="Ghostbox.tools_inject_dependency-421"><a href="#Ghostbox.tools_inject_dependency-421"><span class="linenos">421</span></a><span class="sd">            good_employees = box.text(&quot;Can you give me a quick summary of all the employees in the database that have overperformed last motnh?&quot;)</span>
</span><span id="Ghostbox.tools_inject_dependency-422"><a href="#Ghostbox.tools_inject_dependency-422"><span class="linenos">422</span></a><span class="sd">        # do something with good_employees</span>
</span><span id="Ghostbox.tools_inject_dependency-423"><a href="#Ghostbox.tools_inject_dependency-423"><span class="linenos">423</span></a><span class="sd">        # ...</span>
</span><span id="Ghostbox.tools_inject_dependency-424"><a href="#Ghostbox.tools_inject_dependency-424"><span class="linenos">424</span></a><span class="sd">        ```</span>
</span><span id="Ghostbox.tools_inject_dependency-425"><a href="#Ghostbox.tools_inject_dependency-425"><span class="linenos">425</span></a>
</span><span id="Ghostbox.tools_inject_dependency-426"><a href="#Ghostbox.tools_inject_dependency-426"><span class="linenos">426</span></a><span class="sd">        ## employee_assistant/tools.py</span>
</span><span id="Ghostbox.tools_inject_dependency-427"><a href="#Ghostbox.tools_inject_dependency-427"><span class="linenos">427</span></a><span class="sd">        ```python</span>
</span><span id="Ghostbox.tools_inject_dependency-428"><a href="#Ghostbox.tools_inject_dependency-428"><span class="linenos">428</span></a><span class="sd">        # many tool definitions here</span>
</span><span id="Ghostbox.tools_inject_dependency-429"><a href="#Ghostbox.tools_inject_dependency-429"><span class="linenos">429</span></a><span class="sd">        # ...</span>
</span><span id="Ghostbox.tools_inject_dependency-430"><a href="#Ghostbox.tools_inject_dependency-430"><span class="linenos">430</span></a>
</span><span id="Ghostbox.tools_inject_dependency-431"><a href="#Ghostbox.tools_inject_dependency-431"><span class="linenos">431</span></a><span class="sd">        # then the one the AI will probably choose for our request above</span>
</span><span id="Ghostbox.tools_inject_dependency-432"><a href="#Ghostbox.tools_inject_dependency-432"><span class="linenos">432</span></a><span class="sd">        def query_database(sql_query: str) -&gt; Dict:</span>
</span><span id="Ghostbox.tools_inject_dependency-433"><a href="#Ghostbox.tools_inject_dependency-433"><span class="linenos">433</span></a><span class="sd">            # this would fail without dependency injection</span>
</span><span id="Ghostbox.tools_inject_dependency-434"><a href="#Ghostbox.tools_inject_dependency-434"><span class="linenos">434</span></a><span class="sd">            # since DBHANDLE is not defined in the module</span>
</span><span id="Ghostbox.tools_inject_dependency-435"><a href="#Ghostbox.tools_inject_dependency-435"><span class="linenos">435</span></a><span class="sd">            results = DBHANDLE.query(sql)</span>
</span><span id="Ghostbox.tools_inject_dependency-436"><a href="#Ghostbox.tools_inject_dependency-436"><span class="linenos">436</span></a><span class="sd">            # do stuff with results to bring it into a form the AI likes</span>
</span><span id="Ghostbox.tools_inject_dependency-437"><a href="#Ghostbox.tools_inject_dependency-437"><span class="linenos">437</span></a><span class="sd">            final = some_repackaging(results)</span>
</span><span id="Ghostbox.tools_inject_dependency-438"><a href="#Ghostbox.tools_inject_dependency-438"><span class="linenos">438</span></a><span class="sd">            return final</span>
</span><span id="Ghostbox.tools_inject_dependency-439"><a href="#Ghostbox.tools_inject_dependency-439"><span class="linenos">439</span></a><span class="sd">        ```</span>
</span><span id="Ghostbox.tools_inject_dependency-440"><a href="#Ghostbox.tools_inject_dependency-440"><span class="linenos">440</span></a>
</span><span id="Ghostbox.tools_inject_dependency-441"><a href="#Ghostbox.tools_inject_dependency-441"><span class="linenos">441</span></a><span class="sd">        At the point above where tools_inject_dependency is called, the DBHANDLE identified in the tools.py module becoems defined. Without the injection, referencing it would raise an exception.</span>
</span><span id="Ghostbox.tools_inject_dependency-442"><a href="#Ghostbox.tools_inject_dependency-442"><span class="linenos">442</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox.tools_inject_dependency-443"><a href="#Ghostbox.tools_inject_dependency-443"><span class="linenos">443</span></a>        <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">tools_module</span>
</span><span id="Ghostbox.tools_inject_dependency-444"><a href="#Ghostbox.tools_inject_dependency-444"><span class="linenos">444</span></a>        <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Ghostbox.tools_inject_dependency-445"><a href="#Ghostbox.tools_inject_dependency-445"><span class="linenos">445</span></a>            <span class="n">printerr</span><span class="p">(</span>
</span><span id="Ghostbox.tools_inject_dependency-446"><a href="#Ghostbox.tools_inject_dependency-446"><span class="linenos">446</span></a>                <span class="s2">&quot;warning: Unable to inject dependency &#39;&quot;</span>
</span><span id="Ghostbox.tools_inject_dependency-447"><a href="#Ghostbox.tools_inject_dependency-447"><span class="linenos">447</span></a>                <span class="o">+</span> <span class="n">symbol_name</span>
</span><span id="Ghostbox.tools_inject_dependency-448"><a href="#Ghostbox.tools_inject_dependency-448"><span class="linenos">448</span></a>                <span class="o">+</span> <span class="s2">&quot;&#39;. Tool module not initialized.&quot;</span>
</span><span id="Ghostbox.tools_inject_dependency-449"><a href="#Ghostbox.tools_inject_dependency-449"><span class="linenos">449</span></a>            <span class="p">)</span>
</span><span id="Ghostbox.tools_inject_dependency-450"><a href="#Ghostbox.tools_inject_dependency-450"><span class="linenos">450</span></a>            <span class="k">return</span> <span class="n">Self</span>
</span><span id="Ghostbox.tools_inject_dependency-451"><a href="#Ghostbox.tools_inject_dependency-451"><span class="linenos">451</span></a>
</span><span id="Ghostbox.tools_inject_dependency-452"><a href="#Ghostbox.tools_inject_dependency-452"><span class="linenos">452</span></a>        <span class="c1"># FIXME: should we warn users if they overriade an existing identifier? Let&#39;s do ti since if they injected once why do they need to do it again?</span>
</span><span id="Ghostbox.tools_inject_dependency-453"><a href="#Ghostbox.tools_inject_dependency-453"><span class="linenos">453</span></a>        <span class="k">if</span> <span class="n">symbol_name</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
</span><span id="Ghostbox.tools_inject_dependency-454"><a href="#Ghostbox.tools_inject_dependency-454"><span class="linenos">454</span></a>            <span class="n">printerr</span><span class="p">(</span>
</span><span id="Ghostbox.tools_inject_dependency-455"><a href="#Ghostbox.tools_inject_dependency-455"><span class="linenos">455</span></a>                <span class="s2">&quot;warning: While trying to inject a dependency: &#39;&quot;</span>
</span><span id="Ghostbox.tools_inject_dependency-456"><a href="#Ghostbox.tools_inject_dependency-456"><span class="linenos">456</span></a>                <span class="o">+</span> <span class="n">symbol_name</span>
</span><span id="Ghostbox.tools_inject_dependency-457"><a href="#Ghostbox.tools_inject_dependency-457"><span class="linenos">457</span></a>                <span class="o">+</span> <span class="s2">&quot;&#39; already exists in tool module.&quot;</span>
</span><span id="Ghostbox.tools_inject_dependency-458"><a href="#Ghostbox.tools_inject_dependency-458"><span class="linenos">458</span></a>            <span class="p">)</span>
</span><span id="Ghostbox.tools_inject_dependency-459"><a href="#Ghostbox.tools_inject_dependency-459"><span class="linenos">459</span></a>
</span><span id="Ghostbox.tools_inject_dependency-460"><a href="#Ghostbox.tools_inject_dependency-460"><span class="linenos">460</span></a>        <span class="n">module</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">symbol_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
</span></pre></div>


            <div class="docstring"><p>Make a python object available in the python tool module of a running ghostbox AI, without having defined it in the tools.py.
This can be used to inject dependencies from the 'outside'. This is useful in cases where you must make an object available to the AI that can not be acquired during initialization of the tool module, for example, a resource manager, or a network connection.
Note that the AI will not be aware of an injected dependency, and be unable to reference it. However, you can refer to the symbol_name in the functions you define for the AI, which will be a bound reference as soon as you inject the dependency. The AI may then use the functions that previously didn't refer to the object now bound by symbol_name.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>symbol_name</strong>:  The name of the identifier to be injected. If this is e.g. 'point', point will be bound to obj in tools.py.</li>
<li><strong>obj</strong>:  An arbitrary python object. A reference to object will be bound to symbol_name and be available in tools.py.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Ghostbox
  Here's an example use of dependency injection:</p>
  
  <h2 id="human_resourcespy">human_resources.py</h2>
</blockquote>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">box</span> <span class="o">=</span> <span class="n"><a href="#from_generic">ghostbox.from_generic</a></span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="c1"># imaginary database connection e.g.</span>
<span class="c1"># we don&#39;t want this in the tools.py of employee_assistant</span>
<span class="n">database_handle</span> <span class="o">=</span> <span class="n">EmployeeDatabase</span><span class="o">.</span><span class="n">open_connection</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;bob&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;bruce_schneier&quot;</span><span class="p">)</span>
<span class="c1"># stuff happens, maybe we start a read/evaluate loop</span>
<span class="c1"># ...</span>

<span class="c1"># start our assistant</span>
<span class="n">box</span><span class="o">.</span><span class="n">start_session</span><span class="p">(</span><span class="s2">&quot;employee_assistant&quot;</span><span class="p">)</span>
<span class="c1">#without this, the tool calls would fail</span>
<span class="n">box</span><span class="o">.</span><span class="n">tools_inject_dependency</span><span class="p">(</span><span class="s2">&quot;DBHANDLE&quot;</span><span class="p">,</span> <span class="n">database_handle</span><span class="p">)</span>
<span class="k">with</span> <span class="n">options</span><span class="p">{</span><span class="n">use_tools</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">good_employees</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;Can you give me a quick summary of all the employees in the database that have overperformed last motnh?&quot;</span><span class="p">)</span>
<span class="c1"># do something with good_employees</span>
<span class="c1"># ...</span>
</code></pre>
</div>

<h2 id="employee_assistanttoolspy">employee_assistant/tools.py</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># many tool definitions here</span>
<span class="c1"># ...</span>

<span class="c1"># then the one the AI will probably choose for our request above</span>
<span class="k">def</span><span class="w"> </span><span class="nf">query_database</span><span class="p">(</span><span class="n">sql_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
    <span class="c1"># this would fail without dependency injection</span>
    <span class="c1"># since DBHANDLE is not defined in the module</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">DBHANDLE</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
    <span class="c1"># do stuff with results to bring it into a form the AI likes</span>
    <span class="n">final</span> <span class="o">=</span> <span class="n">some_repackaging</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">final</span>
</code></pre>
</div>

<p>At the point above where tools_inject_dependency is called, the DBHANDLE identified in the tools.py module becoems defined. Without the injection, referencing it would raise an exception.</p>
</div>


                            </div>
                            <div id="Ghostbox.tts_say" class="classattr">
                                        <input id="Ghostbox.tts_say-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tts_say</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">text</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">interrupt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Self</span>:</span></span>

                <label class="view-source-button" for="Ghostbox.tts_say-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.tts_say"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.tts_say-462"><a href="#Ghostbox.tts_say-462"><span class="linenos">462</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tts_say</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">interrupt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="Ghostbox.tts_say-463"><a href="#Ghostbox.tts_say-463"><span class="linenos">463</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Speak something with the underlying TTS engine.</span>
</span><span id="Ghostbox.tts_say-464"><a href="#Ghostbox.tts_say-464"><span class="linenos">464</span></a><span class="sd">        You can modify the tts behaviour by wrapping this call in a `with options(...)` context. For possible options, see the ghostbox documentation of the various tts_* options.</span>
</span><span id="Ghostbox.tts_say-465"><a href="#Ghostbox.tts_say-465"><span class="linenos">465</span></a><span class="sd">        :param text: The text to be spoken.</span>
</span><span id="Ghostbox.tts_say-466"><a href="#Ghostbox.tts_say-466"><span class="linenos">466</span></a><span class="sd">        :param interrupt: If true, this call will interrupt speech output that is currently in progress (the default). Otherwise, text will be queue and spoken in sequence.</span>
</span><span id="Ghostbox.tts_say-467"><a href="#Ghostbox.tts_say-467"><span class="linenos">467</span></a><span class="sd">        :return: The ghostbox instance.</span>
</span><span id="Ghostbox.tts_say-468"><a href="#Ghostbox.tts_say-468"><span class="linenos">468</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox.tts_say-469"><a href="#Ghostbox.tts_say-469"><span class="linenos">469</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">communicateTTS</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">interrupt</span><span class="o">=</span><span class="n">interrupt</span><span class="p">)</span>
</span><span id="Ghostbox.tts_say-470"><a href="#Ghostbox.tts_say-470"><span class="linenos">470</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Speak something with the underlying TTS engine.
You can modify the tts behaviour by wrapping this call in a <code>with options(...)</code> context. For possible options, see the ghostbox documentation of the various tts_* options.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>text</strong>:  The text to be spoken.</li>
<li><strong>interrupt</strong>:  If true, this call will interrupt speech output that is currently in progress (the default). Otherwise, text will be queue and spoken in sequence.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The ghostbox instance.</p>
</blockquote>
</div>


                            </div>
                            <div id="Ghostbox.tts_stop" class="classattr">
                                        <input id="Ghostbox.tts_stop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tts_stop</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Self</span>:</span></span>

                <label class="view-source-button" for="Ghostbox.tts_stop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.tts_stop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.tts_stop-472"><a href="#Ghostbox.tts_stop-472"><span class="linenos">472</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tts_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="Ghostbox.tts_stop-473"><a href="#Ghostbox.tts_stop-473"><span class="linenos">473</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stops speech output that is in progress.</span>
</span><span id="Ghostbox.tts_stop-474"><a href="#Ghostbox.tts_stop-474"><span class="linenos">474</span></a><span class="sd">        :return: The ghostbox instance.</span>
</span><span id="Ghostbox.tts_stop-475"><a href="#Ghostbox.tts_stop-475"><span class="linenos">475</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox.tts_stop-476"><a href="#Ghostbox.tts_stop-476"><span class="linenos">476</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">stopTTS</span><span class="p">()</span>
</span><span id="Ghostbox.tts_stop-477"><a href="#Ghostbox.tts_stop-477"><span class="linenos">477</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Stops speech output that is in progress.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The ghostbox instance.</p>
</blockquote>
</div>


                            </div>
                            <div id="Ghostbox.set_char" class="classattr">
                                        <input id="Ghostbox.set_char-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_char</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">character_folder</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">chat_history</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#ChatMessage">ChatMessage</a></span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Self</span>:</span></span>

                <label class="view-source-button" for="Ghostbox.set_char-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.set_char"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.set_char-479"><a href="#Ghostbox.set_char-479"><span class="linenos">479</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_char</span><span class="p">(</span>
</span><span id="Ghostbox.set_char-480"><a href="#Ghostbox.set_char-480"><span class="linenos">480</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Ghostbox.set_char-481"><a href="#Ghostbox.set_char-481"><span class="linenos">481</span></a>        <span class="n">character_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Ghostbox.set_char-482"><a href="#Ghostbox.set_char-482"><span class="linenos">482</span></a>        <span class="n">chat_history</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ChatMessage</span> <span class="o">|</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Ghostbox.set_char-483"><a href="#Ghostbox.set_char-483"><span class="linenos">483</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="Ghostbox.set_char-484"><a href="#Ghostbox.set_char-484"><span class="linenos">484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set an active character_folder, which may be the same one, and optionally set the chat history.</span>
</span><span id="Ghostbox.set_char-485"><a href="#Ghostbox.set_char-485"><span class="linenos">485</span></a><span class="sd">        This method differs from start_session in that it doesn&#39;t wipe various vars that may be set in the session, and preserves the chat history by default.</span>
</span><span id="Ghostbox.set_char-486"><a href="#Ghostbox.set_char-486"><span class="linenos">486</span></a><span class="sd">        Note: This will wipe the previous history unless chat_history is None.</span>
</span><span id="Ghostbox.set_char-487"><a href="#Ghostbox.set_char-487"><span class="linenos">487</span></a><span class="sd">        :param character_folder: The new character folder to load.</span>
</span><span id="Ghostbox.set_char-488"><a href="#Ghostbox.set_char-488"><span class="linenos">488</span></a><span class="sd">        :param chat_history: A list of ChatHistory items, valid JSON dictionaries that parse as ChatHistoryItems, or a mix of both. If None, chat history will be retained.</span>
</span><span id="Ghostbox.set_char-489"><a href="#Ghostbox.set_char-489"><span class="linenos">489</span></a><span class="sd">        :return: Ghostbox instance.&quot;&quot;&quot;</span>
</span><span id="Ghostbox.set_char-490"><a href="#Ghostbox.set_char-490"><span class="linenos">490</span></a>        <span class="k">if</span> <span class="n">character_folder</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">getOption</span><span class="p">(</span><span class="s2">&quot;character_folder&quot;</span><span class="p">):</span>
</span><span id="Ghostbox.set_char-491"><a href="#Ghostbox.set_char-491"><span class="linenos">491</span></a>            <span class="n">printerr</span><span class="p">(</span><span class="n">start_session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="p">,</span> <span class="n">character_folder</span><span class="p">))</span>
</span><span id="Ghostbox.set_char-492"><a href="#Ghostbox.set_char-492"><span class="linenos">492</span></a>
</span><span id="Ghostbox.set_char-493"><a href="#Ghostbox.set_char-493"><span class="linenos">493</span></a>        <span class="k">if</span> <span class="n">chat_history</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Ghostbox.set_char-494"><a href="#Ghostbox.set_char-494"><span class="linenos">494</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="Ghostbox.set_char-495"><a href="#Ghostbox.set_char-495"><span class="linenos">495</span></a>
</span><span id="Ghostbox.set_char-496"><a href="#Ghostbox.set_char-496"><span class="linenos">496</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">stories</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span id="Ghostbox.set_char-497"><a href="#Ghostbox.set_char-497"><span class="linenos">497</span></a>        <span class="n">story</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">stories</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="Ghostbox.set_char-498"><a href="#Ghostbox.set_char-498"><span class="linenos">498</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">chat_history</span><span class="p">:</span>
</span><span id="Ghostbox.set_char-499"><a href="#Ghostbox.set_char-499"><span class="linenos">499</span></a>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="n">ChatMessage</span><span class="p">:</span>
</span><span id="Ghostbox.set_char-500"><a href="#Ghostbox.set_char-500"><span class="linenos">500</span></a>                <span class="n">story</span><span class="o">.</span><span class="n">appendMessage</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="Ghostbox.set_char-501"><a href="#Ghostbox.set_char-501"><span class="linenos">501</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Ghostbox.set_char-502"><a href="#Ghostbox.set_char-502"><span class="linenos">502</span></a>                <span class="c1"># try to parse the item as ChatMessage</span>
</span><span id="Ghostbox.set_char-503"><a href="#Ghostbox.set_char-503"><span class="linenos">503</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Ghostbox.set_char-504"><a href="#Ghostbox.set_char-504"><span class="linenos">504</span></a>                    <span class="n">story</span><span class="o">.</span><span class="n">addRawJSON</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="Ghostbox.set_char-505"><a href="#Ghostbox.set_char-505"><span class="linenos">505</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="Ghostbox.set_char-506"><a href="#Ghostbox.set_char-506"><span class="linenos">506</span></a>                    <span class="n">printerr</span><span class="p">(</span>
</span><span id="Ghostbox.set_char-507"><a href="#Ghostbox.set_char-507"><span class="linenos">507</span></a>                        <span class="s2">&quot;warning: Couldn&#39;t parse chat history. Not a valid ChatMessage. Skipping message. Traceback below.&quot;</span>
</span><span id="Ghostbox.set_char-508"><a href="#Ghostbox.set_char-508"><span class="linenos">508</span></a>                    <span class="p">)</span>
</span><span id="Ghostbox.set_char-509"><a href="#Ghostbox.set_char-509"><span class="linenos">509</span></a>                    <span class="n">printerr</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
</span><span id="Ghostbox.set_char-510"><a href="#Ghostbox.set_char-510"><span class="linenos">510</span></a>                    <span class="k">continue</span>
</span><span id="Ghostbox.set_char-511"><a href="#Ghostbox.set_char-511"><span class="linenos">511</span></a>
</span><span id="Ghostbox.set_char-512"><a href="#Ghostbox.set_char-512"><span class="linenos">512</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Ghostbox.set_char-513"><a href="#Ghostbox.set_char-513"><span class="linenos">513</span></a>
</span><span id="Ghostbox.set_char-514"><a href="#Ghostbox.set_char-514"><span class="linenos">514</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Set an active character_folder, which may be the same one, and optionally set the chat history.
This method differs from start_session in that it doesn't wipe various vars that may be set in the session, and preserves the chat history by default.
Note: This will wipe the previous history unless chat_history is None.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>character_folder</strong>:  The new character folder to load.</li>
<li><strong>chat_history</strong>:  A list of ChatHistory items, valid JSON dictionaries that parse as ChatHistoryItems, or a mix of both. If None, chat history will be retained.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Ghostbox instance.</p>
</blockquote>
</div>


                            </div>
                            <div id="Ghostbox.history" class="classattr">
                                        <input id="Ghostbox.history-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">history</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n"><a href="#ChatMessage">ChatMessage</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Ghostbox.history-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Ghostbox.history"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Ghostbox.history-516"><a href="#Ghostbox.history-516"><span class="linenos">516</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">history</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ChatMessage</span><span class="p">]:</span>
</span><span id="Ghostbox.history-517"><a href="#Ghostbox.history-517"><span class="linenos">517</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the current chat history for this ghostbox instance.</span>
</span><span id="Ghostbox.history-518"><a href="#Ghostbox.history-518"><span class="linenos">518</span></a><span class="sd">        :return: The chat history.</span>
</span><span id="Ghostbox.history-519"><a href="#Ghostbox.history-519"><span class="linenos">519</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Ghostbox.history-520"><a href="#Ghostbox.history-520"><span class="linenos">520</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plumbing</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">stories</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Returns the current chat history for this ghostbox instance.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The chat history.</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="ChatMessage">
                            <input id="ChatMessage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ChatMessage</span><wbr>(<span class="base">pydantic.main.BaseModel</span>):

                <label class="view-source-button" for="ChatMessage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChatMessage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChatMessage-45"><a href="#ChatMessage-45"><span class="linenos">45</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ChatMessage</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span id="ChatMessage-46"><a href="#ChatMessage-46"><span class="linenos">46</span></a>    <span class="n">role</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;tool&quot;</span><span class="p">]</span>
</span><span id="ChatMessage-47"><a href="#ChatMessage-47"><span class="linenos">47</span></a>    <span class="n">content</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChatContent</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ChatMessage-48"><a href="#ChatMessage-48"><span class="linenos">48</span></a>    <span class="n">tool_calls</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ToolCall</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ChatMessage-49"><a href="#ChatMessage-49"><span class="linenos">49</span></a>    <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ChatMessage-50"><a href="#ChatMessage-50"><span class="linenos">50</span></a>    <span class="n">tool_call_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Usage docs: <a href="https://docs.pydantic.dev/2.10/concepts/models/">https://docs.pydantic.dev/2.10/concepts/models/</a></p>

<p>A base class for creating Pydantic models.</p>

<p>Attributes:
    __class_vars__: The names of the class variables defined on the model.
    __private_attributes__: Metadata about the private attributes of the model.
    __signature__: The synthesized <code><a href="#ChatMessage.__init__">__init__</a></code> [<code>Signature</code>][inspect.Signature] of the model.</p>

<pre><code>__pydantic_complete__: Whether model building is completed, or if there are still undefined fields.
__pydantic_core_schema__: The core schema of the model.
__pydantic_custom_init__: Whether the model has a custom `__init__` function.
__pydantic_decorators__: Metadata containing the decorators defined on the model.
    This replaces `Model.__validators__` and `Model.__root_validators__` from Pydantic V1.
__pydantic_generic_metadata__: Metadata for generic models; contains data used for a similar purpose to
    __args__, __origin__, __parameters__ in typing-module generics. May eventually be replaced by these.
__pydantic_parent_namespace__: Parent namespace of the model, used for automatic rebuilding of models.
__pydantic_post_init__: The name of the post-init method for the model, if defined.
__pydantic_root_model__: Whether the model is a [`RootModel`][pydantic.root_model.RootModel].
__pydantic_serializer__: The `pydantic-core` `SchemaSerializer` used to dump instances of the model.
__pydantic_validator__: The `pydantic-core` `SchemaValidator` used to validate instances of the model.

__pydantic_fields__: A dictionary of field names and their corresponding [`FieldInfo`][pydantic.fields.FieldInfo] objects.
__pydantic_computed_fields__: A dictionary of computed field names and their corresponding [`ComputedFieldInfo`][pydantic.fields.ComputedFieldInfo] objects.

__pydantic_extra__: A dictionary containing extra values, if [`extra`][pydantic.config.ConfigDict.extra]
    is set to `'allow'`.
__pydantic_fields_set__: The names of fields explicitly set during instantiation.
__pydantic_private__: Values of private attributes set on the model instance.
</code></pre>
</div>


                            <div id="ChatMessage.role" class="classattr">
                                <div class="attr variable">
            <span class="name">role</span><span class="annotation">: Literal[&#39;system&#39;, &#39;assistant&#39;, &#39;user&#39;, &#39;tool&#39;]</span>

        
    </div>
    <a class="headerlink" href="#ChatMessage.role"></a>
    
    

                            </div>
                            <div id="ChatMessage.content" class="classattr">
                                <div class="attr variable">
            <span class="name">content</span><span class="annotation">: Union[str, List[ghostbox.definitions.ChatContentComplex], Dict, NoneType]</span>

        
    </div>
    <a class="headerlink" href="#ChatMessage.content"></a>
    
    

                            </div>
                            <div id="ChatMessage.tool_calls" class="classattr">
                                <div class="attr variable">
            <span class="name">tool_calls</span><span class="annotation">: List[ghostbox.definitions.ToolCall]</span>

        
    </div>
    <a class="headerlink" href="#ChatMessage.tool_calls"></a>
    
    

                            </div>
                            <div id="ChatMessage.tool_name" class="classattr">
                                <div class="attr variable">
            <span class="name">tool_name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#ChatMessage.tool_name"></a>
    
    

                            </div>
                            <div id="ChatMessage.tool_call_id" class="classattr">
                                <div class="attr variable">
            <span class="name">tool_call_id</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#ChatMessage.tool_call_id"></a>
    
    

                            </div>
                            <div id="ChatMessage.model_config" class="classattr">
                                <div class="attr variable">
            <span class="name">model_config</span><span class="annotation">: ClassVar[pydantic.config.ConfigDict]</span>        =
<span class="default_value">{}</span>

        
    </div>
    <a class="headerlink" href="#ChatMessage.model_config"></a>
    
            <div class="docstring"><p>Configuration for the model, should be a dictionary conforming to [<code>ConfigDict</code>][pydantic.config.ConfigDict].</p>
</div>


                            </div>
                </section>
                <section id="LLMBackend">
                    <div class="attr class">
            
    <span class="def">class</span>
    <span class="name">LLMBackend</span><wbr>(<span class="base">enum.Enum</span>):

        
    </div>
    <a class="headerlink" href="#LLMBackend"></a>
    
    

                            <div id="LLMBackend.generic" class="classattr">
                                <div class="attr variable">
            <span class="name">generic</span>        =
<span class="default_value">&lt;<a href="#LLMBackend.generic">LLMBackend.generic</a>: 1&gt;</span>

        
    </div>
    <a class="headerlink" href="#LLMBackend.generic"></a>
    
    

                            </div>
                            <div id="LLMBackend.legacy" class="classattr">
                                <div class="attr variable">
            <span class="name">legacy</span>        =
<span class="default_value">&lt;<a href="#LLMBackend.legacy">LLMBackend.legacy</a>: 2&gt;</span>

        
    </div>
    <a class="headerlink" href="#LLMBackend.legacy"></a>
    
    

                            </div>
                            <div id="LLMBackend.llamacpp" class="classattr">
                                <div class="attr variable">
            <span class="name">llamacpp</span>        =
<span class="default_value">&lt;<a href="#LLMBackend.llamacpp">LLMBackend.llamacpp</a>: 3&gt;</span>

        
    </div>
    <a class="headerlink" href="#LLMBackend.llamacpp"></a>
    
    

                            </div>
                            <div id="LLMBackend.koboldcpp" class="classattr">
                                <div class="attr variable">
            <span class="name">koboldcpp</span>        =
<span class="default_value">&lt;<a href="#LLMBackend.koboldcpp">LLMBackend.koboldcpp</a>: 4&gt;</span>

        
    </div>
    <a class="headerlink" href="#LLMBackend.koboldcpp"></a>
    
    

                            </div>
                            <div id="LLMBackend.openai" class="classattr">
                                <div class="attr variable">
            <span class="name">openai</span>        =
<span class="default_value">&lt;<a href="#LLMBackend.openai">LLMBackend.openai</a>: 5&gt;</span>

        
    </div>
    <a class="headerlink" href="#LLMBackend.openai"></a>
    
    

                            </div>
                            <div id="LLMBackend.dummy" class="classattr">
                                <div class="attr variable">
            <span class="name">dummy</span>        =
<span class="default_value">&lt;<a href="#LLMBackend.dummy">LLMBackend.dummy</a>: 6&gt;</span>

        
    </div>
    <a class="headerlink" href="#LLMBackend.dummy"></a>
    
    

                            </div>
                </section>
                <section id="TTSModel">
                    <div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TTSModel</span><wbr>(<span class="base">enum.Enum</span>):

        
    </div>
    <a class="headerlink" href="#TTSModel"></a>
    
    

                            <div id="TTSModel.zonos" class="classattr">
                                <div class="attr variable">
            <span class="name">zonos</span>        =
<span class="default_value">&lt;<a href="#TTSModel.zonos">TTSModel.zonos</a>: 1&gt;</span>

        
    </div>
    <a class="headerlink" href="#TTSModel.zonos"></a>
    
    

                            </div>
                            <div id="TTSModel.kokoro" class="classattr">
                                <div class="attr variable">
            <span class="name">kokoro</span>        =
<span class="default_value">&lt;<a href="#TTSModel.kokoro">TTSModel.kokoro</a>: 2&gt;</span>

        
    </div>
    <a class="headerlink" href="#TTSModel.kokoro"></a>
    
    

                            </div>
                            <div id="TTSModel.xtts" class="classattr">
                                <div class="attr variable">
            <span class="name">xtts</span>        =
<span class="default_value">&lt;<a href="#TTSModel.xtts">TTSModel.xtts</a>: 3&gt;</span>

        
    </div>
    <a class="headerlink" href="#TTSModel.xtts"></a>
    
    

                            </div>
                </section>
                <section id="TTSOutputMethod">
                    <div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TTSOutputMethod</span><wbr>(<span class="base">enum.Enum</span>):

        
    </div>
    <a class="headerlink" href="#TTSOutputMethod"></a>
    
    

                            <div id="TTSOutputMethod.default" class="classattr">
                                <div class="attr variable">
            <span class="name">default</span>        =
<span class="default_value">&lt;<a href="#TTSOutputMethod.default">TTSOutputMethod.default</a>: 1&gt;</span>

        
    </div>
    <a class="headerlink" href="#TTSOutputMethod.default"></a>
    
    

                            </div>
                            <div id="TTSOutputMethod.websock" class="classattr">
                                <div class="attr variable">
            <span class="name">websock</span>        =
<span class="default_value">&lt;<a href="#TTSOutputMethod.websock">TTSOutputMethod.websock</a>: 2&gt;</span>

        
    </div>
    <a class="headerlink" href="#TTSOutputMethod.websock"></a>
    
    

                            </div>
                </section>
                <section id="PromptFormatTemplateSpecialValue">
                    <div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PromptFormatTemplateSpecialValue</span><wbr>(<span class="base">enum.Enum</span>):

        
    </div>
    <a class="headerlink" href="#PromptFormatTemplateSpecialValue"></a>
    
    

                            <div id="PromptFormatTemplateSpecialValue.auto" class="classattr">
                                <div class="attr variable">
            <span class="name">auto</span>        =
<span class="default_value">&lt;<a href="#PromptFormatTemplateSpecialValue.auto">PromptFormatTemplateSpecialValue.auto</a>: 1&gt;</span>

        
    </div>
    <a class="headerlink" href="#PromptFormatTemplateSpecialValue.auto"></a>
    
    

                            </div>
                            <div id="PromptFormatTemplateSpecialValue.guess" class="classattr">
                                <div class="attr variable">
            <span class="name">guess</span>        =
<span class="default_value">&lt;<a href="#PromptFormatTemplateSpecialValue.guess">PromptFormatTemplateSpecialValue.guess</a>: 2&gt;</span>

        
    </div>
    <a class="headerlink" href="#PromptFormatTemplateSpecialValue.guess"></a>
    
    

                            </div>
                            <div id="PromptFormatTemplateSpecialValue.raw" class="classattr">
                                <div class="attr variable">
            <span class="name">raw</span>        =
<span class="default_value">&lt;<a href="#PromptFormatTemplateSpecialValue.raw">PromptFormatTemplateSpecialValue.raw</a>: 3&gt;</span>

        
    </div>
    <a class="headerlink" href="#PromptFormatTemplateSpecialValue.raw"></a>
    
    

                            </div>
                </section>
                <section id="Timings">
                            <input id="Timings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Timings</span><wbr>(<span class="base">pydantic.main.BaseModel</span>):

                <label class="view-source-button" for="Timings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Timings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Timings-114"><a href="#Timings-114"><span class="linenos">114</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Timings</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span id="Timings-115"><a href="#Timings-115"><span class="linenos">115</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Performance statistics for LLM backends.</span>
</span><span id="Timings-116"><a href="#Timings-116"><span class="linenos">116</span></a><span class="sd">    Most backends give timing statistics, though the format and particular stats vary. This class unifies the interface and boils it down to only the stats we care about.</span>
</span><span id="Timings-117"><a href="#Timings-117"><span class="linenos">117</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Timings-118"><a href="#Timings-118"><span class="linenos">118</span></a>
</span><span id="Timings-119"><a href="#Timings-119"><span class="linenos">119</span></a>    <span class="n">prompt_n</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="Timings-120"><a href="#Timings-120"><span class="linenos">120</span></a>    <span class="n">predicted_n</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="Timings-121"><a href="#Timings-121"><span class="linenos">121</span></a>    <span class="n">cached_n</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Timings-122"><a href="#Timings-122"><span class="linenos">122</span></a>    <span class="n">truncated</span><span class="p">:</span> <span class="nb">bool</span>
</span><span id="Timings-123"><a href="#Timings-123"><span class="linenos">123</span></a>    <span class="n">prompt_ms</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="Timings-124"><a href="#Timings-124"><span class="linenos">124</span></a>    <span class="n">predicted_ms</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="Timings-125"><a href="#Timings-125"><span class="linenos">125</span></a>    <span class="n">predicted_per_second</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="Timings-126"><a href="#Timings-126"><span class="linenos">126</span></a>    <span class="n">predicted_per_token_ms</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="Timings-127"><a href="#Timings-127"><span class="linenos">127</span></a>
</span><span id="Timings-128"><a href="#Timings-128"><span class="linenos">128</span></a>    <span class="n">original_timings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Timings-129"><a href="#Timings-129"><span class="linenos">129</span></a>
</span><span id="Timings-130"><a href="#Timings-130"><span class="linenos">130</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">total_n</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Timings-131"><a href="#Timings-131"><span class="linenos">131</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prompt_n</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_n</span>
</span><span id="Timings-132"><a href="#Timings-132"><span class="linenos">132</span></a>
</span><span id="Timings-133"><a href="#Timings-133"><span class="linenos">133</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">total_ms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Timings-134"><a href="#Timings-134"><span class="linenos">134</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prompt_ms</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_ms</span>
</span></pre></div>


            <div class="docstring"><p>Performance statistics for LLM backends.
Most backends give timing statistics, though the format and particular stats vary. This class unifies the interface and boils it down to only the stats we care about.</p>
</div>


                            <div id="Timings.prompt_n" class="classattr">
                                <div class="attr variable">
            <span class="name">prompt_n</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#Timings.prompt_n"></a>
    
    

                            </div>
                            <div id="Timings.predicted_n" class="classattr">
                                <div class="attr variable">
            <span class="name">predicted_n</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#Timings.predicted_n"></a>
    
    

                            </div>
                            <div id="Timings.cached_n" class="classattr">
                                <div class="attr variable">
            <span class="name">cached_n</span><span class="annotation">: Optional[int]</span>

        
    </div>
    <a class="headerlink" href="#Timings.cached_n"></a>
    
    

                            </div>
                            <div id="Timings.truncated" class="classattr">
                                <div class="attr variable">
            <span class="name">truncated</span><span class="annotation">: bool</span>

        
    </div>
    <a class="headerlink" href="#Timings.truncated"></a>
    
    

                            </div>
                            <div id="Timings.prompt_ms" class="classattr">
                                <div class="attr variable">
            <span class="name">prompt_ms</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#Timings.prompt_ms"></a>
    
    

                            </div>
                            <div id="Timings.predicted_ms" class="classattr">
                                <div class="attr variable">
            <span class="name">predicted_ms</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#Timings.predicted_ms"></a>
    
    

                            </div>
                            <div id="Timings.predicted_per_second" class="classattr">
                                <div class="attr variable">
            <span class="name">predicted_per_second</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#Timings.predicted_per_second"></a>
    
    

                            </div>
                            <div id="Timings.predicted_per_token_ms" class="classattr">
                                <div class="attr variable">
            <span class="name">predicted_per_token_ms</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#Timings.predicted_per_token_ms"></a>
    
    

                            </div>
                            <div id="Timings.original_timings" class="classattr">
                                <div class="attr variable">
            <span class="name">original_timings</span><span class="annotation">: Optional[Dict[str, Any]]</span>

        
    </div>
    <a class="headerlink" href="#Timings.original_timings"></a>
    
    

                            </div>
                            <div id="Timings.total_n" class="classattr">
                                        <input id="Timings.total_n-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">total_n</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Timings.total_n-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Timings.total_n"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Timings.total_n-130"><a href="#Timings.total_n-130"><span class="linenos">130</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">total_n</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Timings.total_n-131"><a href="#Timings.total_n-131"><span class="linenos">131</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prompt_n</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_n</span>
</span></pre></div>


    

                            </div>
                            <div id="Timings.total_ms" class="classattr">
                                        <input id="Timings.total_ms-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">total_ms</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="Timings.total_ms-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Timings.total_ms"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Timings.total_ms-133"><a href="#Timings.total_ms-133"><span class="linenos">133</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">total_ms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Timings.total_ms-134"><a href="#Timings.total_ms-134"><span class="linenos">134</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prompt_ms</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicted_ms</span>
</span></pre></div>


    

                            </div>
                            <div id="Timings.model_config" class="classattr">
                                <div class="attr variable">
            <span class="name">model_config</span><span class="annotation">: ClassVar[pydantic.config.ConfigDict]</span>        =
<span class="default_value">{}</span>

        
    </div>
    <a class="headerlink" href="#Timings.model_config"></a>
    
            <div class="docstring"><p>Configuration for the model, should be a dictionary conforming to [<code>ConfigDict</code>][pydantic.config.ConfigDict].</p>
</div>


                            </div>
                </section>
                <section id="api_default_options">
                    <div class="attr variable">
            <span class="name">api_default_options</span>        =
<input id="api_default_options-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="api_default_options-view-value"></label><span class="default_value">{&#39;color&#39;: False, &#39;verbose&#39;: False, &#39;stderr&#39;: True, &#39;log_time&#39;: True, &#39;cli_prompt&#39;: &#39;&#39;, &#39;dynamic_file_vars&#39;: False, &#39;max_context_length&#39;: 32000}</span>

        
    </div>
    <a class="headerlink" href="#api_default_options"></a>
    
    

                </section>
                <section id="get_ghostbox_data">
                            <input id="get_ghostbox_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_ghostbox_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">path</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_ghostbox_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_ghostbox_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_ghostbox_data-15"><a href="#get_ghostbox_data-15"><span class="linenos">15</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_ghostbox_data</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="get_ghostbox_data-16"><a href="#get_ghostbox_data-16"><span class="linenos">16</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns PATH preceded by the location of the ghostbox data dir, which is part of the python site-package.&quot;&quot;&quot;</span>
</span><span id="get_ghostbox_data-17"><a href="#get_ghostbox_data-17"><span class="linenos">17</span></a>    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_ROOT</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns PATH preceded by the location of the ghostbox data dir, which is part of the python site-package.</p>
</div>


                </section>
                <section id="get_ghostbox_html_path">
                            <input id="get_ghostbox_html_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_ghostbox_html_path</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_ghostbox_html_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_ghostbox_html_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_ghostbox_html_path-20"><a href="#get_ghostbox_html_path-20"><span class="linenos">20</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_ghostbox_html_path</span><span class="p">():</span>
</span><span id="get_ghostbox_html_path-21"><a href="#get_ghostbox_html_path-21"><span class="linenos">21</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the path to the index.html and javascript files for the integrated HTTP server.&quot;&quot;&quot;</span>
</span><span id="get_ghostbox_html_path-22"><a href="#get_ghostbox_html_path-22"><span class="linenos">22</span></a>    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_ROOT</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns the path to the index.html and javascript files for the integrated HTTP server.</p>
</div>


                </section>
    </main>
</body>
</html>